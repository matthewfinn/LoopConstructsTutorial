(window.webpackJsonp=window.webpackJsonp||[]).push([[114],{196:function(i,s,t){"use strict";t.d(s,"a",(function(){return r}));var e=t(14),n=t(1),h=t(6);const o=$(document);const r=new class{constructor(){$(document).on("appActivatedAfterLongTime",()=>{this.wishList=null,this.wishListPromise=null,this.isSyncing=!1})}hasInitializedWishList(){return null!=this.wishList}onSyncingChanged(i){this.syncingCallback=i}isBookInWishList(i){return null!=i&&this.isProductInWishList(i.manningId)}isProductInWishList(i){return null!=this.wishList&&null!=this.wishList.items&&0!=this.wishList.items.length&&null!=this.wishList.items.find(s=>null!=s.product&&s.product.id==i)}updateSyncing(i){this.isSyncing!=i&&(this.isSyncing=i,this.syncingCallback&&this.syncingCallback())}addBookToWishList(i){return this.addProductToWishList(i.manningId)}addProductToWishList(i){return new Promise((s,t)=>{this.getUserWishList().then(h=>{if(!h.id)return t("User is not logged in");this.updateSyncing(!0),n.a.postToOurBackend(n.a.getAbsoluteUrl(`api/wishList/${h.id}/addItem/${i}`),e=>{this.updateSyncing(!1),this.syncingCallback&&this.syncingCallback(),e?(this.wishList=e,s(e),this.wishListPromise=Promise.resolve(this.wishList),o.trigger("wishListArrived",e),o.trigger("wishListAdd",[i,!0])):t("Not enough information")},i=>{this.updateSyncing(!1),t(),e.a.getUserEmail().then(i=>{o.trigger("wishListFail",[`${i}-${(new Date).getTime()}`,"N/A","N/A"])}).catch(i=>{o.trigger("wishListFail",[`unknownUser-${(new Date).getTime()}`,"N/A","N/A"])})},{},!0,!0,!1,!1)}).catch(i=>t(i))})}removeProductFromWishList(i){return new Promise((s,t)=>{this.getUserWishList().then(h=>{const r=h.items.find(s=>s.product.id==i);if(!r)return t("wish list item not found");this.updateSyncing(!0),n.a.interactWithOurBackend(n.a.getAbsoluteUrl(`api/wishList/removeItem/${r.id}`),"delete",e=>{if(this.updateSyncing(!1),!e)return o.trigger("wishListFail",[`unknownUser-${(new Date).getTime()}`,"N/A","N/A"]),void t("Not enough information");this.wishList=e,s(e),this.wishListPromise=Promise.resolve(this.wishList),o.trigger("wishListArrived",e),o.trigger("wishListRemove",[i])},i=>{this.updateSyncing(!1),e.a.getUserEmail().then(i=>{o.trigger("wishListFail",[`${i}-${(new Date).getTime()}`,"N/A","N/A"])}).catch(i=>{o.trigger("wishListFail",[`unknownUser-${(new Date).getTime()}`,"N/A","N/A"])})},{},!0,!0,!1,!1)}).catch(i=>t(i))})}getUserWishList(){return h.a.isCurrentlyLoggedIn()?null!=this.wishListPromise?this.wishListPromise:this.wishListPromise=new Promise((i,s)=>{this.updateSyncing(!0),n.a.getFromOurBackend(n.a.getAbsoluteUrl("wishList"),t=>{if(this.updateSyncing(!1),!t)return o.trigger("wishListFail",[`unknownUser-${(new Date).getTime()}`,"N/A","N/A"]),void s("Not enough information");this.wishList=t,i(t),this.wishListPromise=Promise.resolve(this.wishList),o.trigger("wishListArrived",t)},i=>{this.wishListPromise=null,this.updateSyncing(!1),e.a.getUserEmail().then(i=>{o.trigger("wishListFail",[`${i}-${(new Date).getTime()}`,"N/A","N/A"])}).catch(i=>{o.trigger("wishListFail",[`unknownUser-${(new Date).getTime()}`,"N/A","N/A"])})},{},!0,!0,!1,!1)}):Promise.resolve({id:-1,title:"",items:[]})}}},533:function(i,s,t){"use strict";t.r(s),t.d(s,"WishListManager",(function(){return a}));var e=t(196),n=t(12),h=t(11),o=t(4),r=t(6);const a=new class{constructor(){this.handleMainWishListIconClick=this.handleMainWishListIconClick.bind(this),this.handleWishListRemove=this.handleWishListRemove.bind(this),this.$mainWishListIcons=$("#footer .wish-list-icon, #header .wish-list-icon"),o.a.onEventWithCooldown(this.$mainWishListIcons,"click",this.handleMainWishListIconClick),$(document).on("wishListRemove",this.handleWishListRemove)}initalize(i){this.book=i,r.a.isLoggedIn().then(i=>{i.loggedIn&&e.a.getUserWishList().then(i=>{null!=this.$mainWishListIcons&&this.toggleHeartIcons(this.isCurrentBookInWishList(i))})})}clean(){this.book=null,null!=this.$mainWishListIcons&&this.$mainWishListIcons.toggleClass("active",!1).toggleClass("fa-heart",!0)}addCurrentBookToWishList(){this.book&&e.a.getUserWishList().then(i=>{this.isCurrentBookInWishList(i)||e.a.addBookToWishList(this.book).then(()=>{this.toggleHeartIcons(!0),this.$mainWishListIcons.removeClass("pulse"),h.a.visuallyShowHearting()}).catch(i=>{this.$mainWishListIcons.removeClass("pulse")})})}handleMainWishListIconClick(i){r.a.isCurrentlyLoggedIn()?e.a.isSyncing||(this.$mainWishListIcons.addClass("pulse"),e.a.getUserWishList().then(i=>{this.isCurrentBookInWishList(i)?e.a.removeProductFromWishList(this.book.manningId).then(()=>{this.toggleHeartIcons(!1),this.$mainWishListIcons.removeClass("pulse")}).catch(i=>{this.$mainWishListIcons.removeClass("pulse")}):e.a.addBookToWishList(this.book).then(()=>{this.toggleHeartIcons(!0),this.$mainWishListIcons.removeClass("pulse"),h.a.visuallyShowHearting()}).catch(i=>{this.$mainWishListIcons.removeClass("pulse")})}).catch(i=>{this.$mainWishListIcons.removeClass("pulse"),$(document).trigger("requestNotification","Error syncing wish list")})):n.a.requestLogin("sign in to add a book to your wishlist","wishlist")}toggleHeartIcons(i){this.$mainWishListIcons.toggleClass("active",i)}isCurrentBookInWishList(i){return!!(this.book&&i&&i.items&&i.items.length)&&null!=i.items.find(i=>i.product.id==this.book.manningId)}handleWishListRemove(i,s,t){t||null!=this.book&&this.book.manningId==s&&this.toggleHeartIcons(!1)}}}}]);
//# sourceMappingURL=wishListManager.chunk.js.map?0149d838903c0bf7ae49