(window.webpackJsonp=window.webpackJsonp||[]).push([[27,68],{1198:function(e,t,o){"use strict";var i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),n=new Uint8Array(16);function r(){if(!i)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(n)}for(var a=[],s=0;s<256;++s)a.push((s+256).toString(16).substr(1));var l=function(e,t){var o=t||0;return(a[e[o+0]]+a[e[o+1]]+a[e[o+2]]+a[e[o+3]]+"-"+a[e[o+4]]+a[e[o+5]]+"-"+a[e[o+6]]+a[e[o+7]]+"-"+a[e[o+8]]+a[e[o+9]]+"-"+a[e[o+10]]+a[e[o+11]]+a[e[o+12]]+a[e[o+13]]+a[e[o+14]]+a[e[o+15]]).toLowerCase()};t.a=function(e,t,o){var i=(e=e||{}).random||(e.rng||r)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){o=o||0;for(var n=0;n<16;++n)t[o+n]=i[n];return t}return l(i)}},121:function(e,t,o){"use strict";var i;o.d(t,"a",(function(){return i})),o.d(t,"b",(function(){return n})),function(e){e[e.Default=0]="Default",e[e.Search=1]="Search",e[e.Point=2]="Point",e[e.Paragraphs=3]="Paragraphs",e[e.Subsection=4]="Subsection",e[e.Section=5]="Section",e[e.BookElement=6]="BookElement",e[e.FreePreview=7]="FreePreview"}(i||(i={}));const n=new class{markParagraphsForUnscrambling(e){e.forEach(e=>{e.find(".scrambled-notifier").remove(),e.addClass("unscrambling"),e.removeClass("unscramble-target")})}adaptReadableTextContentForUnscrambling(e){e.forEach(e=>{if(e.attr("data-original-html",e.html()),1===e.children().length&&1===e.children("p").length){const t=e.children("p");t.html(`<div class="scrambled-content-container">${t.html()}</div>\n                     <div class="unscrambled-content-container"></div>`)}else e.html(`<div class="scrambled-content-container">${e.html()}</div>\n                     <div class="unscrambled-content-container"></div>`)})}resetUnscrambledElements(e){e.forEach(e=>{e.html(e.attr("data-original-html")),e.attr("data-original-html",""),e.removeClass("unscrambling")})}getDataFromPointingLink(e,t,o){if(!e||!t||!o||o.length<2)return null;const i={bookShortName:e.shortName,bookElementShortName:t.shortName,paragraphId:void 0,paragraphFingerprint:void 0,pointingLinkId:void 0,paragraphsToUnlock:void 0,startParagraphId:void 0,endParagraphId:void 0,meapVersion:t.meapVersion||0,isUserEditorLink:!1};if(2==o.length?(i.paragraphId=o[0],i.paragraphFingerprint=o[1],i.startParagraphId=parseInt(o[0]),i.endParagraphId=parseInt(o[0])):(i.pointingLinkId=o[0],i.startParagraphId=parseInt(o[1]),i.endParagraphId=parseInt(o[2]),i.isUserEditorLink="1"===o[3]),Number.isNaN(i.startParagraphId)||Number.isNaN(i.endParagraphId))return null;if(i.startParagraphId>i.endParagraphId){let e=i.startParagraphId;i.startParagraphId=i.endParagraphId,i.endParagraphId=e}return i}isEncompassingWholeContent(e,t){if("1"!=e)return!1;try{const e=document.querySelector(`[refid="${t}"]`),o=document.querySelector(`[refid="${+t+1}"]`);return null!=e&&null==o}catch(e){return!1}}replaceEncryptedContent(e,t){return t&&t.forEach(t=>{const o=e.find("[refid='"+t.paragraphID+"']");o.is(".scrambled")&&o.html(t.content).removeClass("scrambled").addClass("unscrambled")}),e.html()}}},1225:function(e,t,o){"use strict";o.r(t),o.d(t,"BookPage",(function(){return we}));var i=o(0),n=o(4),r=o(28),a=o(13),s=o(9),l=o(1),c=o(41),d=o(164),h=o(220),u=o(27),m=o(265),g=o(39),p=o(21),b=o(594),k=o(22),f=o(335),w=o(30),v=o(2);const S=new class{initialize(){this.getSource().then(({AudioManager:e})=>{n.a.setTimeout(()=>e.initialize(),250)})}loadBookContent(e,t){this.getSource().then(({AudioManager:o})=>{n.a.setTimeout(()=>o.loadBookContent(e,t),250)})}clean(){this.sourcePromise&&this.sourcePromise.then(({AudioManager:e})=>e.clean())}getSource(){return this.sourcePromise||(this.insertNecessaryHTMLElements(),v.a.loadVelocityCode(),this.sourcePromise=v.a.importWebpackModuleWithRetry(this.constructSourcePromise)),this.sourcePromise}constructSourcePromise(){return Promise.all([o.e(7),o.e(23)]).then(o.bind(null,1227))}insertNecessaryHTMLElements(){$(document.body).append('<audio id="audio-player" preload="metadata" crossorigin="anonymous"></audio>')}};var P=o(29),C=o(3),E=o(121),I=o(259),M=o(47),x=o(10),y=o(218),N=o(1198),T=o(582),A=o(184);const O=new class{constructor(){this.readLoggingInterval=3e4,this.idleInterval=3e5,this.slowReadingSpeed=1.33,this.isIdle=!1,this.numIdledRequests=0,this.logReading=this.logReading.bind(this),this.handleOnActive=this.handleOnActive.bind(this),this.handleOnIdle=this.handleOnIdle.bind(this),this.handleScroll=this.handleScroll.bind(this),$(document).on("appActivated",this.handleOnActive),$(document).on("appIdle",this.handleOnIdle),this.maxIdledRequests=this.idleInterval/this.readLoggingInterval,$(document).on("scroll",this.handleScroll)}initialize(e,t){const o=!this.book&&null!=e||null!=e&&null!=this.book&&this.book.shortName!=e.shortName;this.book=e,this.bookElement=t,clearTimeout(this.bookReadLogTimer),t.reviewVersion>0||(o&&(this.sessionId=Object(N.a)()),A.a.isVisible().then(e=>{this.isLoggingEnabled=e}),this.logReading())}clean(){this.book=null,this.bookElement=null,this.sessionId=null,clearTimeout(this.bookReadLogTimer)}logReading(){if(null!=this.book&&null!=this.bookElement){if(this.isIdle){this.numIdledRequests++;let e=this.numIdledRequests*this.readLoggingInterval/1e4,t=this.getNumWordsInScreen();if(this.numIdledRequests>=this.maxIdledRequests||e>t/this.slowReadingSpeed)return void(this.bookReadLogTimer=n.a.setTimeout(this.logReading,this.readLoggingInterval))}if(this.isIdle=!0,!this.userAgentMatchesBot()){if(this.isLoggingEnabled){const e=m.a.getTopMostReadableElement(),t=m.a.getCurrentSectionTitle();let o=null!=e&&e.attr("refid")||"1",i="";if(t){let e=t.trim(),o=x.a.extractNumbering(e);if(o){let e=o.split(".");i=e[0]+"."+(e[1]?`${e[1]}.`:"")}}T.a.logReading(this.book.shortName,this.bookElement.shortName,o,i,this.book.userOwnsBook,this.bookElement.isOpen,this.bookElement.meapVersion,this.book.manningId,this.sessionId,this.readLoggingInterval,this.book.sisterLicenseId,this.book.associatedLicenseId).then(e=>{if(this.book&&e&&e.success&&e.todaysReadingTime){let t="";t=this.book.userOwnsBook?"user-action-reading-owned-book":this.bookElement.isOpen?"user-action-reading-open-chapter":"user-action-reading-free-preview",$(document).trigger(t,[this.book.manningId,e.todaysReadingTime,!1])}})}this.bookReadLogTimer=n.a.setTimeout(this.logReading,this.readLoggingInterval)}}else this.bookReadLogTimer=n.a.setTimeout(this.logReading,this.readLoggingInterval)}getNumWordsInScreen(){let e=s.a.getVisibleParagraphs(),t=0;return e.forEach(e=>{t+=e.innerText.replace(/[^_0-9a-zA-Z]/g," ").trim().split(/\s+/).length}),t}handleOnIdle(){this.isLoggingEnabled=!1}handleOnActive(){this.isLoggingEnabled=!0}handleScroll(e){this.isIdle=!1,this.numIdledRequests=0}userAgentMatchesBot(){return/bot|googlebot|crawler|spider|robot|crawling/i.test(navigator.userAgent)}};var z=o(336),B=o(19),W=o(5),L=o(6),R=o(18),V=o(135),F=o(48);const D=new class{initialize(e){this.getSource().then(({FreeEbookUpsellManager:t})=>t.initialize(e))}clean(){this.sourcePromise&&this.sourcePromise.then(({FreeEbookUpsellManager:e})=>e.clean())}getSource(){return this.sourcePromise||(v.a.loadMustacheCode(),this.sourcePromise=v.a.importWebpackModuleWithRetry(this.constructSourcePromise)),this.sourcePromise}constructSourcePromise(){return o.e(47).then(o.bind(null,1216))}};var H=o(25);const q='<div id="newest-edition-box" class="hidden">\n<a href="" class="newest-edition-available-link">\n    <div class="newest-edition-available-heading">new edition available</div>\n    <div class="newest-edition-available-book-title"></div>\n    <div class="newest-edition-available-this-included">This edition is included with the purchase of the revised book.</div>\n</a>\n</div>',U=new class{constructor(){this.shouldBeShownWhenAppropriate=!1,$(document.body).append(q),this.textSlideMenuBeginOpening=this.textSlideMenuBeginOpening.bind(this),this.textSlideMenuEndClosing=this.textSlideMenuEndClosing.bind(this),$(document).on("textSlideMenuBeginOpening slideMenuStartOpening",this.textSlideMenuBeginOpening).on("slideMenuClosed",this.textSlideMenuEndClosing)}initialize(e){this.book=e,H.a.getNewestEditionProduct(e).then(t=>{null!=t&&t.newestEditionProduct&&t.newestEditionProduct.slug?(e.newerEditionId=t.newestEditionProduct.id,this.shouldBeShownWhenAppropriate=!0,this.renderNewestEditionNotification(e,t)):this.shouldBeShownWhenAppropriate=!1})}clean(){this.book=null,$("#newest-edition-box").addClass("hidden"),this.shouldBeShownWhenAppropriate=!1}renderNewestEditionNotification(e,t){if(!e.userOwnsBook){const e=$("#newest-edition-box");e.removeClass("hidden"),e.find(".newest-edition-available-link").attr("href",l.a.getBookElementUrl(t.newestEditionProduct.slug,"")),e.find(".newest-edition-available-book-title").text(t.newestEditionProduct.title),e.find(".newest-edition-available-this-included").css("display",t.isCurrentProductTheFreeEdition?"block":"none")}}textSlideMenuBeginOpening(){$("#newest-edition-box").addClass("hidden")}textSlideMenuEndClosing(){null!=this.book&&!this.book.userOwnsBook&&this.shouldBeShownWhenAppropriate&&$("#newest-edition-box").removeClass("hidden")}};var _=o(23);const j=new class{constructor(){this.initializeTermViewerManager=this.initializeTermViewerManager.bind(this),$(document).on("requestTermViewerInitialization",this.initializeTermViewerManager)}initialize(e,t){if(null==e||!e.hasKnowledgeGraph)return;if(!e.isKnowledgeGraphAccessible&&!e.userIsEditor)return;let o=16;L.a.isCurrentlyLoggedIn()||null!=this.termViewEmphasizerSourcePromise||(o=7e3),n.a.setTimeout(()=>{this.getTermViewEmphasizerSource().then(({TermViewerEmphasizer:o})=>{o.initialize(e,t)})},o)}initializeTermViewerManager(e,t,o,i,n,r,a){this.getTermViewerManagerSource().then(({TermViewerManager:e})=>{e.initialize(t,o,i,n,r),e.handleInlineIndexedTermClick(a)})}getTermViewerManagerSource(){return this.termViewerManagerSourcePromise||(this.termViewerManagerSourcePromise=v.a.importWebpackModuleWithRetry(this.constructTermViewerManagerSourcePromise)),this.termViewerManagerSourcePromise}constructTermViewerManagerSourcePromise(){return Promise.all([o.e(0),o.e(2),o.e(11),o.e(106),o.e(81)]).then(o.bind(null,1217))}getTermViewEmphasizerSource(){return this.termViewEmphasizerSourcePromise||(this.termViewEmphasizerSourcePromise=v.a.importWebpackModuleWithRetry(this.constructTermViewerEmphasizerSourcePromise)),this.termViewEmphasizerSourcePromise}constructTermViewerEmphasizerSourcePromise(){return Promise.all([o.e(107),o.e(82)]).then(o.bind(null,1218))}clean(){this.termViewEmphasizerSourcePromise&&this.termViewEmphasizerSourcePromise.then(({TermViewerEmphasizer:e})=>e.clean()),this.termViewerManagerSourcePromise&&this.termViewerManagerSourcePromise.then(({TermViewerManager:e})=>e.clean())}};const J=new class{loadZoomableImages(){0!=$(".figure-container[data-high-resolution-path]").length&&n.a.setTimeout(()=>{this.getSource().then(({ZoomableImageManager:e})=>{e.adjustZoomableImages()})},6e3)}initializePinchableImages(){this.getSource().then(({ZoomableImageManager:e})=>{e.adjustPinchZoomImages()})}getSource(){return this.sourcePromise||(this.sourcePromise=v.a.importWebpackModuleWithRetry(this.constructSourcePromise)),this.sourcePromise}constructSourcePromise(){return Promise.all([o.e(109),o.e(115)]).then(o.bind(null,1219))}};const Z=new class{loadExternalIframes(){0!=$(".interactive-container iframe").length&&n.a.setTimeout(()=>{null!=C.a.book&&this.getSource().then(({ExternalIframesManager:e})=>{e.initialize(C.a.book)})},6e3)}getSource(){return this.sourcePromise||(this.sourcePromise=v.a.importWebpackModuleWithRetry(this.constructSourcePromise)),this.sourcePromise}constructSourcePromise(){return Promise.all([o.e(101),o.e(44)]).then(o.bind(null,1220))}};const G=new class{initialize(e,t){e&&e.hasTextAddendums?this.getSource().then(({TextAddendumManager:o})=>o.initialize(e,t)):$(document).trigger("initialTextAddendumsCreated")}clean(){this.sourcePromise&&this.sourcePromise.then(({TextAddendumManager:e})=>e.clean())}getSource(){return this.sourcePromise||(this.sourcePromise=v.a.importWebpackModuleWithRetry(this.constructSourcePromise)),this.sourcePromise}constructSourcePromise(){return o.e(83).then(o.bind(null,325))}};var K=o(406),Y=o(337),Q=o(197);o(267),o(595);const X=new class{initialize(e){C.a.isShoppingCartDisabledInApp&&i.b.isApp()||!e||e.userOwnsBook&&e.userOwnsAudio||e.hasBeenDownloaded||this.getSource().then(({AddToCartManager:t})=>t.initialize(e))}clean(){this.sourcePromise&&this.getSource().then(({AddToCartManager:e})=>e.clean())}getSource(){return this.sourcePromise||(this.sourcePromise=v.a.importWebpackModuleWithRetry(this.constructSourcePromise)),this.sourcePromise}constructSourcePromise(){return o.e(20).then(o.bind(null,1236))}};var ee=o(338),te=o(20),oe=o(596);const ie=new class{show(e,t){this.getSource().then(({MeapModal:o})=>o.showMeapNotification(e,t))}getSource(){return this.sourcePromise||(this.sourcePromise=v.a.importWebpackModuleWithRetry(this.constructSourcePromise)),this.sourcePromise}constructSourcePromise(){return o.e(60).then(o.bind(null,1221))}};var ne=o(52);const re=new class{initialize(e){return this.getSource().then(({PdfManager:t})=>t.initialize(e))}getSource(){return this.sourcePromise||(this.sourcePromise=v.a.importWebpackModuleWithRetry(this.constructSourcePromise)),this.sourcePromise}constructSourcePromise(){return Promise.all([o.e(0),o.e(17),o.e(102),o.e(64)]).then(o.bind(null,1222))}};o(770);var ae=o(44),se=o(15);const le=new class{initialize(){const e=a.a.getHeadings(),t=null!=C.a.book&&C.a.book.isFreeEbook,o=se.a.get("tour-taken"),i=this.hasSections(e);let n=0;e.each((e,r)=>{const a=$(r);if("1"==a.attr("refid"))return!0;if(i&&!x.a.isSection(a.text().trim()))return!0;const s=a.closest(".readable-text");0==n?this.insertAddToCartOrFallback(t,s):1==n?this.createSignInContainer(t?"to access this free ebook":"for more free preview time").insertBefore(s):2==n?this.insertTourOrFallback(o,t,s):n%3==0?this.insertTourOrFallback(o,t,s):n%4==0?this.insertAddToCartOrFallback(t,s):this.createSignInContainer(t?"to access this free ebook":"for more free preview time").insertBefore(s),n++}),$(document).on("click",".inline-promo-tour-button",e=>{ae.a.startTour(),$(document).trigger("tour","inline-promo-tour-start")})}insertTourOrFallback(e,t,o){e?this.createSignInContainer(t?"to access this free ebook":"for more free preview time").insertBefore(o):this.createTourContainer().insertBefore(o)}insertAddToCartOrFallback(e,t){e||H.a.isInShoppingCartByManningId(C.a.book.manningId)?this.createSignInContainer("to access this free ebook").insertBefore(t):this.createAddToCartContainer().insertBefore(t)}createAddToCartContainer(){return this.createPromoContainer(`\n            <div class="inline-promo-title"> Get ${C.a.book.cleanTitle||C.a.book.title} </div>\n            <div class="inline-promo-button inline-promo-cart-button"> add to cart </div>\n        `,"add-to-cart-inline-promo")}createTourContainer(){return this.createPromoContainer('\n            <div class="inline-promo-title"> Tour livebook </div>\n            <p>\n                Take our tour and find out more about liveBook\'s features:\n            </p>\n            <ul>\n                <li>Search - full text search of all our books</li>\n                <li>Discussions - ask questions and interact with other readers in the discussion forum.</li>\n                <li>Highlight, annotate, or bookmark.</li>\n            </ul>\n            <div class="inline-promo-button inline-promo-tour-button"> take the tour </div>\n        ')}createSignInContainer(e){return this.createPromoContainer(`\n            <div class="inline-promo-title"> Sign in ${e}</div>\n            <div class="inline-promo-button inline-promo-sign-in-button"> sign in now </div>\n        `)}createPromoContainer(e,t=""){return $(`<div class="inline-promo-container ${t}">${e}</div>`)}hasSections(e){let t=0;return e.each((e,o)=>{x.a.isSection($(o).text().trim())&&t++}),t>0}};var ce=o(221),de=o(405);const he=new class{initialize(){null!=C.a.bookElement&&C.a.bookElement.reviewVersion>0&&C.a.bookElement.isOpen&&!C.a.bookElement.pdf&&L.a.isLoggedIn().then(e=>{e&&e.loggedIn&&this.getSource().then(({ContentFeedbackManager:e})=>{e.initialize()})})}clean(){null!=this.sourcePromise&&this.getSource().then(({ContentFeedbackManager:e})=>{e.clean()})}getSource(){return this.sourcePromise||(this.sourcePromise=v.a.importWebpackModuleWithRetry(this.constructSourcePromise)),this.sourcePromise}constructSourcePromise(){return Promise.all([o.e(15),o.e(46)]).then(o.bind(null,1223))}};var ue=o(339),me=o(407),ge=o(36);const pe=new class{constructor(){this.handleTccContentLinkClick=this.handleTccContentLinkClick.bind(this)}initialize(){$(".tcc-content-link").on("click",this.handleTccContentLinkClick)}clean(){$(".tcc-content-link").off("click",this.handleTccContentLinkClick)}handleTccContentLinkClick(e){const t=e.target.href,o=t.substring(t.indexOf("book/"));$(document).trigger("tccContentClick",o),ge.a.processThisChapterCoversAction(o)}};var be=o(219);const ke=$(document);const fe=`<div id="meap-sticker-container" class="hidden"><div id="meap-sticker"><img alt="meap badge" src="${l.a.getLivebookCdn()}assets/images/meap-badge.svg"/></div></div>`,we=new class{constructor(){this.pageClass="book-page",this.$mainPageContent=$("#main-page-content"),this.handleAppReactivated=this.handleAppReactivated.bind(this),this.handleSingleScroll=this.handleSingleScroll.bind(this),this.handleOrientationChange=this.handleOrientationChange.bind(this),ke.on("bookElementUnlocked",(e,t,o,i)=>{n.a.setTimeout(()=>this.handlePurchaseSuccessful(i),5)}),this.hasScrolledSincePageLoaded=!1}initialize(e,t,o,i,n){this.isActive=!0;let r=s.a.getCurrentMainContentTranslateX();s.a.translateMainContent(r),this.meapVersion=i,this.additional=n,g.a.initialize(),$(window).one("scroll",this.handleSingleScroll),this.loadBookContent(e,o),$(document).on("appActivatedAfterLongTime",this.handleAppReactivated),$(window).on("orientationchange",this.handleOrientationChange)}getBook(){return this.book}loadBookContent(e,t){if(!this.isActive)return;const o=e.book,s=e.bookElement;this.book=o,this.bookElement=s,this.adaptUI(),C.a.book=o,C.a.conceptPageBookInfo=null,C.a.bookElement=s,C.a.shouldImmediatelyPlayLiveaudio=-1!=document.location.href.indexOf("liveaudio=true"),s.pdf?(re.initialize(s.content),this.updatePreviousNextBookElement(e.previousBookElement,e.nextBookElement),$("body").addClass("pdf-book"),this.updateBodyClasses(o,s),this.updatePageTitle(o.title,o.shortName)):(this.trackContentBuildingProcess(this.additional),this.handleBookElementDataRecieved(e),this.processPointingLinkIfNecessary(this.book,this.bookElement,this.additional)),o&&s&&(a.a.updateTitle((s.title||"")+" - "+(o.title||"")),a.a.updateMetaContent(this.getThisChapterCoversContent()),a.a.updateMetaImage(o.bookCoverPath),a.a.updateCanonicalLink(o.slug,s.shortName,s.meapVersion),s.pdf||(i.b.isGoogleMobileScreenSize()?n.a.onUserHasInteracted(()=>this.fillBookElementStructurePricingInfoIfNecessary()):this.fillBookElementStructurePricingInfoIfNecessary())),me.a.initialize(),F.a.initialize(),ue.a.initialize(),pe.initialize(),L.a.isLoggedIn().then(e=>{e.loggedIn&&M.a.initialize(o,s)}),o.hasAudio&&s.audioLocation&&s.subtitlesLocation&&l.a.urlExists(s.subtitlesLocation).then(e=>{e&&(S.initialize(),S.loadBookContent(o,s))}),o.userOwnsBook||s.isOpen||(n.a.setTimeout(()=>{i.b.isGoogleMobileScreenSize()?n.a.onUserHasInteracted(()=>P.a.initialize(o,s,this.initialElement)):P.a.initialize(o,s,this.initialElement)},250),L.a.isCurrentlyLoggedIn()||s.pdf||n.a.setTimeout(()=>le.initialize(),16)),n.a.setTimeout(()=>O.initialize(o,s),1e4),n.a.setTimeout(()=>u.a.initialize(o,s),16),s.pdf||(n.a.setTimeout(()=>{i.b.isGoogleMobileScreenSize()?n.a.onUserHasInteracted(()=>ee.a.initialize(o)):ee.a.initialize(o)},32),n.a.setTimeout(()=>de.a.promote(),32),n.a.setTimeout(()=>h.a.initialize(o,s),48),n.a.setTimeout(()=>he.initialize(),16),n.a.setTimeout(()=>Z.loadExternalIframes(),10),n.a.setTimeout(()=>G.initialize(o,s),500),L.a.isLoggedIn().then(e=>{e.loggedIn?s.reviewVersion>0?ce.a.initialize(o,s):Q.a.initialize(o,s):o.isFreeEbook||s.pdf||s.isOpen||be.b.initializeIfNecessary()}),n.a.setTimeout(()=>oe.a.initialize(!1),300),n.a.setTimeout(()=>d.a.initialize(o,s),400),n.a.setTimeout(()=>this.initializeAutomaticDownloadIfNecessary(),500),n.a.setTimeout(()=>{i.b.isGoogleMobileScreenSize()?n.a.onUserHasInteracted(()=>j.initialize(o,s)):j.initialize(o,s)},700),n.a.setTimeout(()=>{i.b.isGoogleMobileScreenSize()?n.a.onUserHasInteracted(()=>k.a.initalizeDiscussionNotificationParagraphs(o,s)):k.a.initalizeDiscussionNotificationParagraphs(o,s)},1e3),s.reviewVersion||(n.a.setTimeout(()=>U.initialize(o),6e3),n.a.setTimeout(()=>{i.b.isGoogleMobileScreenSize()?n.a.onUserHasInteracted(()=>X.initialize(o)):X.initialize(o)},500),n.a.setTimeout(()=>y.a.initialize(o,s),6016))),n.a.setTimeout(()=>{i.b.isGoogleMobileScreenSize()?n.a.onUserHasInteracted(()=>K.a.initialize(o,s)):K.a.initialize(o,s)},300),n.a.setTimeout(()=>m.a.initialize(o,s,!0),100),n.a.setTimeout(()=>Y.a.initialize(o,s,t),510),n.a.setTimeout(()=>I.a.initialize(o),550),o.hasExercises?l.a.urlExists(s.exercisesLocation).then(e=>{e?f.a.load(o,s):ke.trigger("initialExercisesCreated")}):ke.trigger("initialExercisesCreated"),$(document).trigger("initializeRequested",[o,s,t]),s.meapVersion&&this.showMeapSticker(),o.isFreeEbook&&D.initialize(o),o.userIsEditor&&($(".settings-editor-section .edit-book-link").attr("href",r.a.formEditLinkFromBookSlugAndBookElementShortName(o.slug,s.shortName)),$(".settings-editor-section .back-to-regular-book-link").attr("href",r.a.formLinkFromBookSlugAndBookElementShortName(o.slug,s.shortName))),(o.userIsAuthor||o.userIsEditor)&&$(".settings-editor-section .book-review-link").attr("href",r.a.formReviewReportLinkFromBookSlugAndBookElementShortName(o.slug,s.shortName,s.reviewVersion)),n.a.setTimeout(()=>ne.a.initializeIfNecessary(this.book,this.bookElement),100),n.a.setTimeout(()=>{k.a.initializeIfNecessary(this.book,this.bookElement),x.a.isSpecialDiscussionPart(t)||x.a.isDiscussionErrata(t)?(p.a.showNotification("Opening discussion"),n.a.setTimeout(()=>{k.a.requestOpen(C.a.book,C.a.bookElement),p.a.hideNotification()},2100)):x.a.isSpecialCommentPart(t)&&(p.a.showNotification("Opening discussion"),n.a.setTimeout(()=>{0==t.indexOf("comment-")&&k.a.requestShowCommentWhenReady(t.replace("comment-",""))},2100))},2e3)}clean(){h.a.clean(),Y.a.clean(),K.a.clean(),P.a.clean(),F.a.initialize(),oe.a.clean(),I.a.clean(),D.clean(),y.a.clean(),X.clean(),O.clean(),z.PromoManager.clean(),Q.a.clean(),ue.a.clean(),pe.clean(),c.a.isSideMenuOpened&&this.isActive&&ke.trigger("slideMenuCloseRequested",{type:"pageInitialization"}),$("body").removeClass(this.pageClass).removeClass("review-book pdf-book user-reviewer review-report-page concept-page"),this.partialClean()}retryImageLoading(){this.$mainPageContent.find("img").on("error",e=>{const t=e.target;t.src&&t.src.indexOf("/v-")>=0?t.src=t.src.replace(/\/v-[0-9]+/i,""):t.src&&t.src.indexOf("/r-")>=0&&(t.src=t.src.replace(/\/r-[0-9]+/i,""))})}partialClean(){this.isActive=!1,this.initialElement=null,this.book=null,this.bookElement=null,C.a.book=null,C.a.bookElement=null,C.a.shouldImmediatelyPlayLiveaudio=!1,this.meapVersion="",this.additional="",this.hasScrolledSincePageLoaded=!1,$("#header-notification-container").addClass("hidden"),$("#meap-sticker-container").addClass("hidden");const e=$("#footer");e.find(".previous-element-link, .next-element-link").addClass("invisible"),e.find(".footer-book-title-label").addClass("hidden"),e.find(".copyright-label").removeClass("hidden"),$("body").removeClass("subtitles-loaded user-owns-book user-owns-audio user-doesnt-own-book book-meap user-is-editor free-ebook review-book book-edit"),$(".summary-wrapper").remove(),$("#track-point-column").removeClass("shown").addClass("hidden"),c.a.isSideMenuOpened&&c.a.$openedMenu&&s.a.closeMenuIfTakesTooMuchSpace(c.a.$openedMenu),w.a.clean(),S.clean(),d.a.clean(),m.a.clean(),oe.a.clean(),Q.a.cleanNotes(),g.a.clean(),u.a.clean(),ee.a.clean(),f.a.clean(),G.clean(),r.a.clean(),te.a.clean(),Y.a.partialClean(),P.a.clean(),U.clean(),C.a.isUnlockingWholeContentThroughPointingLink=!1,k.a.clean(),j.clean(),he.clean(),ue.a.clean(),$(document).off("appActivated",this.handleAppReactivated),$(window).off("scroll",this.handleSingleScroll),$(window).off("orientationchange",this.handleOrientationChange)}processAdditional(e){if(!e)return;const t=e;if(0===t.indexOf("search-")){let e=t.substring(t.lastIndexOf("search-")+"search-".length);const o=$(document.getElementById(e)).closest(".readable-text, .browsable-container");this.initialElement=o[0],o.addClass("paragraph-selected")}else if(0===t.indexOf("note-"))C.a.noteTargetParagraph=t.substring(t.indexOf("note-")+"note-".length);else{if(0===t.indexOf("section-"))return void(this.initialElement=s.a.getSectionHeading(t));if(0===t.indexOf("point-")){let o=t.substring("point-".length).split("-");2===o.length?e=o[0]:o.length>2&&(e=o[1])}}const o=document.getElementById(e);o&&(this.initialElement=$(o).closest(".readable-text, .browsable-container")[0])}adaptUI(){$("body").addClass(this.pageClass).removeClass("landing-page").removeClass("concept-page"),null!=this.bookElement&&this.bookElement.reviewVersion>0&&($("body").addClass("review-book"),this.book.userIsReviewer&&$("body").addClass("user-reviewer"))}handleBookElementDataRecieved(e){const t=e.book,o=e.bookElement,r=$("#book-content-main-row.backend-main-page-content:not(.book-element-full-content-filled)").length>0,a=$("#book-markup-container .inline-book-info-container"),l=$("#readers-ask");$("#book-markup-container").html(e.bookElement.content),$("#book-content-main-row").addClass("book-element-full-content-filled"),$(".backend-main-page-content").removeClass("backend-main-page-content"),$(document).trigger("requestPromoLayoutAdaption"),o.subtitlesLocation&&$("#track-point-column").removeClass("hidden").addClass("shown"),r&&a.length&&$("#book-markup-container").prepend(a),r&&l.length&&($(".introduction-summary").after(l),$(".readers-ask-question").off("click").on("click",e=>{const t=$(e.target).closest(".readers-ask-question-answer-container");t.toggleClass("open"),$(document).trigger("readersAskQuestionsInteraction",{questionIndex:+t.attr("data-question-index"),action:"toggle"})}),$(".readers-ask-link").off("click").on("click",e=>{const t=$(e.target).closest(".readers-ask-question-answer-container");$(document).trigger("readersAskQuestionsInteraction",{questionIndex:+t.attr("data-question-index"),action:"link"})})),this.updateBodyClasses(t,o);const c=()=>{this.updatePreviousNextBookElement(e.previousBookElement,e.nextBookElement),this.updatePageTitle(t.title,t.shortName)};i.b.isGoogleMobileScreenSize()?n.a.onUserHasInteracted(c,!0):c(),b.a.insertNextChapterSummary(e.nextBookElement),i.b.isApp()&&e&&e.book&&e.book.hasBeenDownloaded&&this.retryImageLoading(),n.a.triggerDocumentEventAsync("bookContentLoaded",[t,e,L.a.isCurrentlyLoggedIn()]),i.b.isCordova()?n.a.setTimeout(()=>J.initializePinchableImages(),50):n.a.setTimeout(()=>J.loadZoomableImages(),50),n.a.setTimeout(()=>s.a.loadPlaceholderImages(),100);let d=null!=document.querySelector(".scrambled");ke.trigger("openedChapter",{scrambled:d,loggedIn:L.a.isCurrentlyLoggedIn()})}updateBodyClasses(e,t){$("body").toggleClass("user-owns-book",e.userOwnsBook).toggleClass("user-doesnt-own-book",!e.userOwnsBook).toggleClass("user-owns-audio",e.userOwnsAudio).toggleClass("book-meap",e.isMeap).toggleClass("user-is-editor",e.userIsEditor).toggleClass("free-ebook",e.isFreeEbook).toggleClass("review-book",t.reviewVersion>0)}fillBookElementStructurePricingInfoIfNecessary(){this.book&&this.bookElement&&!this.bookElement.isOpen&&this.book.shortName&&this.bookElement.shortName&&B.a.getCompleteBookElementPriceInfo(this.book.shortName,this.bookElement.shortName,this.bookElement.meapVersion).then(e=>{null!=e&&0!=e.tokenPrice&&null!=this.bookElement&&(this.bookElement.bookElementPriceInfo=e,P.a.initialize(this.book,this.bookElement,null))}).catch(e=>{console.log("Cannot get book element price info")})}updatePreviousNextBookElement(e,t){const o=$("#footer");e&&this.updateLink(o.find(".previous-element-link"),e,!0),t&&this.updateLink(o.find(".next-element-link"),t)}updateLink(e,t,o){e.removeClass("invisible"),e.attr("title",t.title),e.attr("href",r.a.adjustBookLink(t.link));let i=o?"Prev ":"Next ";const n=t.shortName.toLowerCase();0==n.indexOf("part")?i+="Part":0==n.indexOf("chapter")?i+="Chapter":0==n.indexOf("appendix")&&(i+="Appendix"),e.find(".book-element-label").text(i)}updatePageTitle(e,t){const o=a.a.cleanBookTitle(e);$("#footer .copyright-label").addClass("hidden"),$("#footer .footer-book-title-label").removeClass("hidden"),$("#footer .footer-book-title-label .book-title-label-text").attr("title",e).text(o).attr("data-book-short-name",t)}trackContentBuildingProcess(e=""){let t=!this.book.hasExercises,o=!1,i=!1,a=!1;const l=document.location.href;""!=e&&"1"!=e&&p.a.showNotification('<div class="jumping-dots" title="scrolling to the exact position">\n                    <span class="dot"></span>\n                    <span class="dot"></span>\n                    <span class="dot"></span>\n                </div>'),!e&&null!=this.bookElement&&this.bookElement.location&&L.a.isCurrentlyLoggedIn()&&(e=this.bookElement.location+"");const c=()=>{if(!this.isActive)return;let c=!1,d=!1,h=!1,m=!1,b=!1,f=!1,w=!1,v=!1;if(e&&(c=0===e.indexOf("search-"),d=0===e.indexOf("point-"),h=0===e.indexOf("section-"),b=0===e.indexOf("note-"),f=0===e.indexOf("comment-"),w=0===e.indexOf("discussion"),v=0===e.indexOf("tour"),this.processAdditional(e)),this.initialElement&&!this.bookElement.isBookOverview||(this.initialElement=this.getFirstElement(),m=!0),$(this.initialElement).find("h1").length>0&&(m=!0),t&&o&&i&&a){if(ke.trigger("contentFullyConstructed",[this.book,this.bookElement,this.initialElement,l]),c&&ke.trigger("searchHighlightRequested",[this.book,this.bookElement]),b)return void p.a.hideNotification();if(f)return k.a.requestShowCommentWhenReady(e.substring("comment-".length),0,()=>ke.trigger("initialElementInView")),void p.a.hideNotification();if(w)return p.a.showNotification("Opening discussion"),void n.a.setTimeout(()=>{k.a.initializeAndOpen(this.book,this.bookElement),p.a.hideNotification()},2100);if(v)return p.a.showNotification("Starting tour"),void n.a.setTimeout(()=>{ae.a.startTour(),p.a.hideNotification()},2100);n.a.setTimeout(()=>ke.trigger("playingTextFragmentChange",this.initialElement),100),this.initialElement?n.a.setTimeout(()=>{if(p.a.hideNotification(),g.a.shouldAutomaticallyScroll||c||d||!m||h){const t=()=>{const t=$(this.initialElement);if(u.a.storeLatestPage(t.attr("refid")),ke.trigger("initialElementInView"),c&&t.is(".scrambled"))P.a.unlockFragments(this.book,this.bookElement,E.a.Search,"",[t],l).then(()=>ke.trigger("searchHighlightRequested",[this.book,this.bookElement])).catch(e=>{});else if(d){let t=e.substring("point-".length).split("-");P.a.tryToUnlockPointedParagraph(this.book,this.bookElement,t,l)}};c||d||!this.hasScrolledSincePageLoaded?g.a.scrollToElement(this.initialElement,t):(ke.trigger("initialElementInView"),null!=this.initialElement&&s.a.isElementVisibleEvenALittle(this.initialElement)&&$(document).trigger("requestNotification",`<a href="${r.a.formLink(this.book,this.bookElement,$(this.initialElement).attr("refid"))}">click here to move to location</a>`))}},400):(ke.trigger("initialElementInView"),p.a.hideNotification())}};ke.one("initialExercisesCreated",()=>{t=!0,c()}),ke.one("initialTextAddendumsCreated",()=>{a=!0,c()}),ke.one("videoSectionsInserted",()=>{o=!0,c()}),ke.one("annotatedListingsLoaded",()=>{i=!0,c()})}processPointingLinkIfNecessary(e,t,o){if(!e||!t||!o)return;let i=o.substring("point-".length).split("-");const n=E.b.getDataFromPointingLink(e,t,i);n&&(C.a.isUnlockingWholeContentThroughPointingLink=E.b.isEncompassingWholeContent(n.startParagraphId,n.endParagraphId))}getFirstElement(){const e=$(".inline-book-info-container");if(0!=e.length)return e[0];const t=$("#book-markup-container h1").parents(".readable-text");return t.length<=1?t[0]:void 0}handlePurchaseSuccessful(e){null!=e&&null!=this.book&&-1!==e.indexOf(this.book.title)&&(p.a.showTemporaryNotification("Unlocking content and reloading book!"),n.a.setTimeout(()=>{const e=this.book&&this.book.slug,t=this.bookElement&&this.bookElement.shortName;this.clean(),-1!=(document.location.hash||document.location.pathname).indexOf("/payment-confirmation")?document.location.href=l.a.getBookElementUrl(e,t):l.a.reloadPage()},6e3))}handleShowMeapClick(){ie.show(this.book,this.meapVersion)}getThisChapterCoversContent(){const e=$(".introduction-summary li");let t="";return e.each((e,o)=>{t+=$(o).text().trim()+"; "}),t}initializeAutomaticDownloadIfNecessary(){i.b.isApp()&&this.book&&!this.book.hasBeenDownloaded&&(this.book.userOwnsBook&&this.book.userCanDownloadBook||this.book.userIsReviewer)&&(this.hasBookDownloadBeenAutomaticallyOffered(this.book.shortName)||(this.logBookDownloadAutomaticOffering(this.book.shortName),_.a.requestBookDownload(this.book,this.bookElement&&this.bookElement.reviewVersion)))}hasBookDownloadBeenAutomaticallyOffered(e){try{return!!JSON.parse(W.a.getItem("AUTOMATIC_BOOK_DOWNLOADS")||"{}")[e]}catch(e){return!0}}logBookDownloadAutomaticOffering(e){try{const t=JSON.parse(W.a.getItem("AUTOMATIC_BOOK_DOWNLOADS")||"{}");t[e]=!0,W.a.setItem("AUTOMATIC_BOOK_DOWNLOADS",JSON.stringify(t))}catch(e){}}handleAppReactivated(e,t){L.a.isCurrentlyLoggedIn()&&null!=this.book&&R.a.getBookProgress(this.book.shortName).then(e=>{if(null!=e&&null!=this.bookElement)if(e.bookElementShortName==this.bookElement.shortName){const t=m.a.getTopMostReadableElement(),o=$(`[data-hash=${e.contentItemID}], [refid='${e.contentItemID}']`);parseInt(o.attr("refid"))>parseInt(t.attr("refid"))&&$(document).trigger("requestNotification",`<a href="${r.a.formLink(this.book,this.bookElement,e.contentItemID)}">click here to jump to your latest position</a>`)}else V.a.getTocAndIndex(this.book.shortName,this.book,this.bookElement).then(t=>{if(!t||!t.toc)return;const o=x.a.getBookElementOrdinalFromToc(t.toc,this.bookElement.shortName),i=x.a.getBookElementOrdinalFromToc(t.toc,e.bookElementShortName);-1!=o&&-1!=i&&i>o&&$(document).trigger("requestNotification",`<a href="${l.a.getBookElementUrl(this.book.slug,e.bookElementShortName)}${e.contentItemID}">click here to jump to your latest position</a>`)})})}showMeapSticker(){n.a.setTimeout(()=>{let e=$("#meap-sticker-container");0==e.length&&(e=$(document.body).append(fe),(e=$("#meap-sticker-container")).find("#meap-sticker").on("click",this.handleShowMeapClick.bind(this))),e.removeClass("hidden")},330)}handleSingleScroll(){this.hasScrolledSincePageLoaded=!0}handleOrientationChange(){const e=u.a.getLatestLocation();if(console.log(`Orientation changed: ${e}`),!e)return;const t=document.querySelector(`.readable-text[refid='${e}']`);n.a.setTimeout(()=>{g.a.scrollToElement(t)},250)}}},184:function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var i=o(2);const n=new class{isVisible(){return new Promise((e,t)=>{document.visibilityState?e("visible"==document.visibilityState):this.getSource().then(({VisibilityFallback:t})=>e(t.isVisible())).catch(t=>e(!0))})}getSource(){return this.sourcePromise||(this.sourcePromise=i.a.importWebpackModuleWithRetry(this.constructSourcePromise)),this.sourcePromise}constructSourcePromise(){return o.e(112).then(o.bind(null,375))}}},197:function(e,t,o){"use strict";o.d(t,"a",(function(){return s}));var i=o(2),n=o(0),r=o(4),a=o(3);const s=new class{constructor(){this.loadTextAddonsCodeOnInteraction=this.loadTextAddonsCodeOnInteraction.bind(this)}loadCodeOnInteraction(){r.a.onPassiveEvent(document.querySelectorAll(".book-element-additional-commands-notebook-item"),["mouseenter","touchstart","click"],this.loadTextAddonsCodeOnInteraction)}initialize(e,t){this.getTextAddonsMenuSource().then(({TextAddonsMenu:o})=>o.initialize(e,t)),this.getNotesManagerSource().then(({NotesManager:o})=>o.initialize(e,t))}clean(){this.textAddonsMenuSourcePromise&&this.textAddonsMenuSourcePromise.then(({TextAddonsMenu:e})=>e.clean())}requestOpen(){this.getTextAddonsMenuSource().then(({TextAddonsMenu:e})=>e.open())}cleanNotes(){this.notesManagerSourcePromise&&this.notesManagerSourcePromise.then(({NotesManager:e})=>e.clean())}annotate(e,t,o){this.getNotesManagerSource().then(({NotesManager:i})=>i.annotate(e,t,o))}addNote(e,t,o){this.getNotesManagerSource().then(({NotesManager:i})=>i.addNote(e,t,o))}openNotes(e,t){this.getNotesManagerSource().then(({NotesManager:o})=>o.showNotesBox(e,t))}removeNote(e){this.getNotesManagerSource().then(({NotesManager:t})=>t.removeNote(e))}editNote(e,t){this.getNotesManagerSource().then(({NotesManager:o})=>o.editNote(e,t))}getNoteTextFragment(e){return new Promise((t,o)=>{this.getNotesManagerSource().then(({NotesManager:o})=>{o.getNoteTextFragment(e).then(e=>t(e)).catch(e=>t(null))}).catch(e=>t(null))})}getTextFragmentNotes(e){return new Promise((t,o)=>{this.getNotesManagerSource().then(({NotesManager:o})=>{o.getTextFragmentNotes(e).then(e=>t(e)).catch(e=>t([]))}).catch(e=>t([]))})}loadTextAddonsCodeOnInteraction(e){let t="click"==e.type||n.b.isTouchEventOnTouchDevice(e.type);r.a.offPassiveEvent(document.querySelectorAll(".book-element-additional-commands-notebook-item"),[e.type],this.loadTextAddonsCodeOnInteraction),this.getTextAddonsMenuSource().then(({TextAddonsMenu:o})=>{o.initialize(a.a.book,a.a.bookElement),t&&o.open(),r.a.offPassiveEvent(document.querySelectorAll(".book-element-additional-commands-notebook-item"),t?["mouseenter","touchstart","click"]:[e.type],this.loadTextAddonsCodeOnInteraction)})}getTextAddonsMenuSource(){return this.textAddonsMenuSourcePromise||(i.a.loadMustacheCode(),this.textAddonsMenuSourcePromise=i.a.importWebpackModuleWithRetry(this.constructTextAddonsSourcePromise),r.a.offPassiveEvent(document.querySelectorAll(".book-element-additional-commands-notebook-item"),["mouseenter","touchstart","click"],this.loadTextAddonsCodeOnInteraction)),this.textAddonsMenuSourcePromise}constructTextAddonsSourcePromise(){return Promise.all([o.e(3),o.e(84)]).then(o.bind(null,585))}getNotesManagerSource(){return this.notesManagerSourcePromise||(i.a.loadMustacheCode(),i.a.loadVelocityCode(),this.notesManagerSourcePromise=i.a.importWebpackModuleWithRetry(this.constructNotesManagerSourcePromise)),this.notesManagerSourcePromise}constructNotesManagerSourcePromise(){return Promise.all([o.e(3),o.e(63)]).then(o.bind(null,571))}}},218:function(e,t,o){"use strict";o.d(t,"a",(function(){return g}));var i=o(1),n=o(25),r=(o(260),o(12)),a=o(4),s=o(3),l=o(35),c=o(9),d=o(6),h=o(0),u=o(5);const m="NEW_VERSIONS_HIDDEN";const g=new class{constructor(){this.$headerNotificationContainer=$("#header-notification-container"),this.$headerNotificationContainer.on("click",".free-ebook-sign-in",()=>{r.a.requestOpenModal("signin","sign in to read this free ebook","free-ebook-sign-in")}),this.$headerNotificationContainer.on("click",".free-preview-sign-in",e=>{$(e.target).is(".add-dotd-book-to-cart")||r.a.requestOpenModal("signin","sign in to unlock this book","free-preview-sign-in")}),this.$headerNotificationContainer.on("click",".close-promo-button",()=>{this.hideHeaderNotifier(),$(document).trigger("headerNotifierHidden")}),this.$headerNotificationContainer.on("click",".add-dotd-book-to-cart",()=>{null!=this.dotdPromoInfo&&n.a.requestAddBookToCartByBookShortName(s.a.book.shortName,this.dotdPromoInfo.discountCode),this.dotdPromoInfo=null,this.hideHeaderNotifier()}),this.$headerNotificationContainer.on("click",".header-notification-close-icon",e=>{this.storeNewVersionInfoHidden(s.a.book&&s.a.book.shortName,$(e.target).attr("data-meap-version")),this.hideHeaderNotifier()}),this.$headerNotificationContainer.on("click",".free-preview-start",e=>{$(e.target).is(".newer-version-link")?document.location=e.target.href:$(document).trigger("freePreviewRequested")}),$(document).on("freePreviewModeActivated freePreviewModeDeactivated",()=>{a.a.setTimeout(()=>{this.renderFreePreviewMessaging()},16)}),$(document).on("freePreviewModeExpired",()=>{d.a.isCurrentlyLoggedIn()&&this.hideHeaderNotifier()})}setDotdPromotion(e){this.dotdPromoInfo=e,this.initialize(s.a.book,s.a.bookElement)}initialize(e,t){if(null!=e||null!=t){if(e.latestMeapVersion!=t.meapVersion&&0!=e.latestMeapVersion&&null!=t.meapVersion&&t.meapVersion&&!t.reviewVersion&&!this.shouldNewVersionInfoBeHidden(s.a.book&&s.a.book.shortName,e.latestMeapVersion))return this.$headerNotificationContainer.html(`<a href="${i.a.getBookElementUrl(s.a.book.slug,s.a.bookElement.shortName)}"> Newer version available! <span class='action-label'>Access the latest version</span></a> <span class="fa fa-times header-notification-close-icon" data-meap-version="${e.latestMeapVersion}"></span>`),void this.showHeaderNotifier();this.shouldNewVersionInfoBeHidden(s.a.book&&s.a.book.shortName)||n.a.getNewestEditionProduct(e).then(t=>{null!=t&&t.newestEditionProduct&&t.newestEditionProduct.slug&&(e.newerEditionId=t.newestEditionProduct.id,this.$headerNotificationContainer.html(`<a href="${i.a.getBookElementUrl(t.newestEditionProduct.slug,"")}"> Newer edition available! <span class='action-label'>Access the latest version</span></a><span class="fa fa-times header-notification-close-icon"></span>`),this.showHeaderNotifier())}),h.b.isApp()||this.renderPromoMessage()}else h.b.isApp()||this.renderPromoMessage()}clean(){this.hideHeaderNotifier()}renderPromoMessage(){if(null==this.dotdPromoInfo)return;const e=null!=s.a.book&&s.a.book.shortName==this.dotdPromoInfo.productExternalId;if(null==s.a.book||e){if(null!=s.a.book&&s.a.book.userOwnsBook)return;this.showHeaderNotifier(),this.$headerNotificationContainer.html(`\n                <div class='promo-header'>\n                    <a class="single-line ${e?"add-dotd-book-to-cart":""}" href="${e?"javascript:void(0)":this.dotdPromoInfo.productLink}" data-product-external-id=${this.dotdPromoInfo.productExternalId}>${e?this.dotdPromoInfo.shortMessage:this.dotdPromoInfo.headerMessage}</a>\n                    <i class="fal fa-times close-promo-button" data-product-external-id="${this.dotdPromoInfo.productExternalId}"/>\n                </div>\n            `)}}renderFreePreviewMessaging(){if(null!=s.a.bookElement&&s.a.bookElement.isOpen)return;if(!c.a.hasScrambledParagraphs())return;const e=this.getHeadingAndDescription(s.a.book,d.a.isCurrentlyLoggedIn());null!=e?(this.showHeaderNotifier(),this.$headerNotificationContainer.html(`<div class="free-preview-notifier ${e.additionalClass||""}">\n                <span class="free-preview-heading-wrapper">${e.heading}</span>\n                ${e.description?`<i class="fa fa-question-circle dont-propagate-click" data-tooltip aria-haspopup="true" data-title="${e.description}" aria-hidden="true"></i>`:""}\n                <a class="newer-version-link dont-propagate-click hidden" style='display: inline;' href="">(access the <span style='text-decoration: underline'>latest</span> version)</a>\n             </div>`),"free-preview-starting"==e.additionalClass&&this.countDownToAutoStartFreePreview(),"free-preview-start"!=e.additionalClass&&"free-preview-running"!=e.additionalClass&&"free-preview-sign-in"!=e.additionalClass||(s.a.book.latestMeapVersion!=s.a.bookElement.meapVersion?this.updateNewerVersionLink(i.a.getBookElementUrl(s.a.book.slug,s.a.bookElement.shortName)):n.a.getNewestEditionProduct(s.a.book).then(e=>{null!=e&&e.newestEditionProduct&&e.newestEditionProduct.slug&&this.updateNewerVersionLink(i.a.getBookElementUrl(e.newestEditionProduct.slug,""))}))):this.hideHeaderNotifier()}updateNewerVersionLink(e){this.$headerNotificationContainer.find(".newer-version-link").attr("href",e).removeClass("hidden")}countDownToAutoStartFreePreview(){0!=this.$headerNotificationContainer.find(".free-preview-auto-start-countdown").length&&a.a.setTimeout(()=>{this.$headerNotificationContainer.find(".free-preview-count-down-wrapper").addClass("activate-1"),a.a.setTimeout(()=>{this.$headerNotificationContainer.find(".free-preview-count-down-wrapper").removeClass("activate-1").addClass("activate-2"),a.a.setTimeout(()=>{this.$headerNotificationContainer.find(".free-preview-count-down-wrapper").removeClass("activate-2").addClass("activate-3"),a.a.setTimeout(()=>{$(document).trigger("anonymousFreePreviewStartRequested")},1e3)},1e3)},1e3)},1)}getHeadingAndDescription(e,t){return e&&e.isFreeEbook?t?null:{heading:"<span class='action-label'>sign in</span> to access this free eBook",description:"This eBook is free after you log in",additionalClass:"free-ebook-sign-in"}:null==e?null:s.a.isFreePreviewActive()?{heading:this.hasAdditionalPriceMessage()?"in free preview"+this.getAdditionalPriceMessage():`freely previewing ${s.a.book.cleanTitle}`,description:"",additionalClass:"free-preview-running"}:l.a.isFreePreviewAtBeginningAndNotStarted(e)||l.a.isFreePreviewAvailable(e)?t?e.isOpen?{heading:"<span class='action-label'>start</span> your 24h free preview",description:"The text will unlock so you can read this book for 24 hours.",additionalClass:"free-preview-start"}:{heading:"<span class='action-label'>start</span> your free preview",description:"The text will unlock so you can read each liveBook for a couple of minutes per day.",additionalClass:"free-preview-start"}:{heading:"starting free preview in <span class='free-preview-auto-start-countdown'><div class='free-preview-count-down-wrapper'><div class='free-preview-count-down-3'>3</div><div class='free-preview-count-down-2'>2</div><div class='free-preview-count-down-1'>1</div><div class='free-preview-count-down-0'>0</div></div></span>",additionalClass:"free-preview-starting",description:""}:l.a.hasFreePreviewExpired(e)&&!t?e.isOpen?{heading:"<span class='action-label'>sign in</span> to unlock the whole book for 24h"+this.getAdditionalPriceMessage(),description:"The text will unlock so you can read this book for 24 hours.",additionalClass:"free-preview-sign-in"}:{heading:"<span class='action-label'>sign in</span> to unlock the whole book"+this.getAdditionalPriceMessage(),description:"The text will unlock so you can read each liveBook for a total of 5 minutes per day.",additionalClass:"free-preview-sign-in"}:void 0}getAdditionalPriceMessage(){return this.hasAdditionalPriceMessage()?` <span class="action-label add-dotd-book-to-cart" data-product-external-id=${this.dotdPromoInfo.productExternalId}>(get the book for ${this.dotdPromoInfo.priceMessage})</span>`:""}hasAdditionalPriceMessage(){return null!=this.dotdPromoInfo&&null!=s.a.book&&this.dotdPromoInfo.productExternalId==s.a.book.shortName}hideHeaderNotifier(){this.$headerNotificationContainer.addClass("hidden"),$(document.body).removeClass("header-notifier-shown"),$(document).trigger("headerNotifierHidden")}showHeaderNotifier(){this.$headerNotificationContainer.removeClass("hidden"),$(document.body).addClass("header-notifier-shown"),$(document).trigger("headerNotifierShown")}shouldNewVersionInfoBeHidden(e,t){try{const o=JSON.parse(u.a.getItem(m)||"{}");return!!o[e]&&(t?o[e]&&o[e][t]:!!o[e])}catch(e){return!1}}storeNewVersionInfoHidden(e,t){try{const o=JSON.parse(u.a.getItem(m)||"{}");o[e]||(o[e]={}),t&&(o[e][t]=!0),u.a.setItem(m,JSON.stringify(o))}catch(e){}}}},219:function(e,t,o){"use strict";o.d(t,"a",(function(){return i})),o.d(t,"b",(function(){return a}));var i,n=o(2),r=o(3);!function(e){e[e.moreFreePreviewAfterLogin=0]="moreFreePreviewAfterLogin",e[e.offerFreeChapter=1]="offerFreeChapter",e[e.offer24hFree=2]="offer24hFree"}(i||(i={}));const a=new class{initializeIfNecessary(){try{r.a.shouldOfferSimpleSignup()&&(console.log("Initializing simple signup"),this.getSource().then(({SimpleSignupManager:e})=>e.initialize()))}catch(e){console.log("simple signup module",e)}}show(e,t=!1){this.getSource().then(({SimpleSignupManager:o})=>o.show(e,t))}showCurrentExperimentEndedMessage(){this.getSource().then(({SimpleSignupManager:e})=>e.showCurrentExperimentEndedMessage())}getSource(){return this.sourcePromise||(this.sourcePromise=n.a.importWebpackModuleWithRetry(this.constructSourcePromise)),this.sourcePromise}constructSourcePromise(){return Promise.all([o.e(0),o.e(1),o.e(14),o.e(78)]).then(o.bind(null,534))}}},221:function(e,t,o){"use strict";o.d(t,"a",(function(){return r}));var i=o(2),n=o(3);const r=new class{constructor(){this.annotateWholeTextFragment=this.annotateWholeTextFragment.bind(this)}initialize(e,t){this.getReviewManagerSource().then(({ReviewManager:e})=>{e.initialize()}),this.getNotesMenuSource().then(({NotesMenu:o})=>o.initialize(e,t)),null!=e&&e.userIsReviewer&&$(".readable-text").on("click",this.annotateWholeTextFragment)}annotate(e,t,o){this.getNotesMenuSource().then(({NotesMenu:i})=>i.annotate(e,t,o))}addReviewItem(e,t,o,i,n,r){return new Promise((a,s)=>{this.getReviewManagerSource().then(({ReviewManager:l})=>{l.addReviewItem(e,t,o,i,n,r).then(e=>a(e)).catch(e=>s(e))}).catch(e=>s(e))})}clean(){this.reviewManagerSourcePromise&&this.reviewManagerSourcePromise.then(({ReviewManager:e})=>e.clean())}getReviewManagerSource(){return this.reviewManagerSourcePromise||(this.reviewManagerSourcePromise=i.a.importWebpackModuleWithRetry(this.constructSourcePromise)),this.reviewManagerSourcePromise}constructSourcePromise(){return Promise.all([o.e(0),o.e(5),o.e(11),o.e(15),o.e(71)]).then(o.bind(null,579))}getNotesMenuSource(){return this.notesMenuSourcePromise||(i.a.loadMustacheCode(),i.a.loadVelocityCode(),this.notesMenuSourcePromise=i.a.importWebpackModuleWithRetry(this.constructNotesMenuSourcePromise)),this.notesMenuSourcePromise}constructNotesMenuSourcePromise(){return o.e(62).then(o.bind(null,317))}annotateWholeTextFragment(e){let t=$(e.currentTarget);t.is("h4, h5, img")&&(t=t.closest(".browsable-container"));const o=$(e.target);if(!o.is("a")&&!(o.is(".text-marginalia-container")||o.closest(".text-marginalia-container").length>0||o.is(".highlighted-comment-text")||o.closest(".highlighted-comment-text").length>0)&&!window.getSelection().toString().trim()&&n.a.bookElement&&n.a.bookElement.reviewVersion>0&&n.a.book&&n.a.book.userIsReviewer){let e="";t.is(".readable-text")?e=t.text():t.is(".browsable-container")&&(e=t.find("h1, h2, h3, h4, h5").text()),e&&this.getPointingSelectionSource().then(({PointingSelection:o})=>{o.isSelectingParagraphs()||this.annotate(t.get(0),e,0)}).catch(o=>{this.annotate(t.get(0),e,0)})}}getPointingSelectionSource(){return this.pointingSelectionPromise||(this.pointingSelectionPromise=i.a.importWebpackModuleWithRetry(this.constructPointingSelectionSourcePromise)),this.pointingSelectionPromise}constructPointingSelectionSourcePromise(){return o.e(65).then(o.bind(null,188))}}},259:function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var i=o(2);const n=new class{constructor(){this.shouldWishListABeShown=!0}initialize(e){this.getWishListManagerSource().then(({WishListManager:t})=>t.initalize(e))}clean(){this.getWishListManagerSource().then(({WishListManager:e})=>e.clean())}addCurrentBookToWishList(){this.getWishListManagerSource().then(({WishListManager:e})=>e.addCurrentBookToWishList())}getWishListManagerSource(){return this.wishListManagerSourcePromise||(this.wishListManagerSourcePromise=i.a.importWebpackModuleWithRetry(this.constructWishListManagerSourcePromise)),this.wishListManagerSourcePromise}constructWishListManagerSourcePromise(){return o.e(114).then(o.bind(null,533))}}},260:function(e,t,o){var i=o(88),n=o(261);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);var r={insert:"head",singleton:!1};i(n,r);e.exports=n.locals||{}},261:function(e,t,o){(t=o(89)(!1)).push([e.i,"#header-notification-container{position:relative;background-color:#5facbe;line-height:1.8;color:white;text-align:center;margin:0 auto;user-select:none;-webkit-user-select:none}#header-notification-container .header-notification-close-icon{position:absolute;top:50%;transform:translateY(-50%);right:0.5rem;cursor:pointer;user-select:none}@media screen and (max-width: 600px){#header-notification-container .header-notification-close-icon{right:0.2rem}}@media screen and (max-width: 689px){#header-notification-container{font-size:0.75rem}#header-notification-container .fa{font-size:1em !important}}#header-notification-container a{color:white;font-weight:350;display:block;width:100%;font-size:13px;padding:2px}#header-notification-container .action-label{text-decoration:underline;display:inline-block}#header-notification-container .free-preview-notifier{cursor:pointer;font-weight:300;user-select:none;-webkit-user-select:none;background-color:#ffcc00;color:#3c3c3c;transition:background-color 0.5s ease-in;white-space:nowrap;padding:0 1em;overflow:hidden;text-overflow:ellipsis}#header-notification-container .free-preview-notifier.free-preview-starting .free-preview-heading-wrapper{display:flex;justify-content:center}#header-notification-container .free-preview-notifier.free-preview-running{background-color:#5cb85c;color:white;cursor:initial}#header-notification-container .free-preview-notifier span {font-size:90%;font-weight:300}#header-notification-container .free-preview-notifier i{font-size:inherit !important;display:inline-block;margin-left:0.25em}#header-notification-container .free-preview-notifier .free-preview-auto-start-countdown{position:relative;overflow:hidden;display:inline-block;height:1.4em;margin-left:0.3em;font-weight:bold}#header-notification-container .free-preview-notifier .free-preview-count-down-wrapper{transition:transform 1s ease-in-out}#header-notification-container .free-preview-notifier .free-preview-count-down-wrapper.activate-1{transform:translateY(-25%)}#header-notification-container .free-preview-notifier .free-preview-count-down-wrapper.activate-2{transform:translateY(-50%)}#header-notification-container .free-preview-notifier .free-preview-count-down-wrapper.activate-3{transform:translateY(-75%)}#header-notification-container .free-preview-notifier .free-preview-count-down-3{display:block}#header-notification-container .free-preview-notifier .free-preview-count-down-2{display:block}#header-notification-container .free-preview-notifier .free-preview-count-down-1{display:block}.promo-header{padding:0 0.5em;display:flex;align-items:center}.promo-header a{font-weight:normal}.promo-header a:hover{text-decoration:underline}.promo-header .fa{margin:0 0.5em;cursor:pointer}.add-dotd-book-to-cart{cursor:pointer}\n",""]),e.exports=t},336:function(e,t,o){"use strict";o.r(t),o.d(t,"PromoManagerClass",(function(){return d})),o.d(t,"PromoManager",(function(){return h}));var i=o(218),n=o(42),r=o(5),a=o(3),s=o(1),l=o(25);const c="LB_HIDDEN_PROMOTIONS";class d{constructor(){this.version=this.getNextPromoIndex(),this.trackDotdClose=this.trackDotdClose.bind(this),this.trackSiteWideSaleClose=this.trackSiteWideSaleClose.bind(this),this.modifySiteLayoutForSiteWideHeaderPromo=this.modifySiteLayoutForSiteWideHeaderPromo.bind(this),this.handleSiteWidePromoClick=this.handleSiteWidePromoClick.bind(this)}promoteSitewideSale(){this.getHiddenPromotionMap()[this.getPromotionKey()]?this.hideSiteWideSalePromotion():(1==this.version?this.showSiteWideHeaderSalePromotion(!0,!0):2==this.version?this.showSiteWideHeaderSalePromotion(!1,!0):3==this.version?this.showSiteWideFooterSalePromotion(!0,!1):4==this.version?this.showSiteWideFooterSalePromotion(!1,!1):5==this.version?this.showSiteWideHeaderSalePromotion(!0,!1):6==this.version?this.showSiteWideHeaderSalePromotion(!1,!1):7==this.version?this.showSiteWideFooterSalePromotion(!0,!0):8==this.version&&this.showSiteWideFooterSalePromotion(!1,!0),this.trackEvents())}promoteDotd(){n.a.getDotdPromoInfo().then(e=>{if(null==e)return;this.getHiddenPromotionMap()[e.productExternalId]||(i.a.setDotdPromotion(e),this.trackEvents())})}clean(){i.a.clean()}trackEvents(){$(document).on("click",".close-promo-button, .add-dotd-book-to-cart",this.trackDotdClose).on("click",".close-side-wide-sale-button",this.trackSiteWideSaleClose).on("requestPromoLayoutAdaption",this.modifySiteLayoutForSiteWideHeaderPromo).on("click",".site-wide-promo",this.handleSiteWidePromoClick)}handleSiteWidePromoClick(e){if(!$(e.target).is(".close-side-wide-sale-button, .fa")&&null!=a.a.book&&!a.a.book.userOwnsBook){const e=$(".site-wide-promo-pbook").length>0;l.a.requestAddBookToCart(a.a.book,!1,"",!1,e),$(document).trigger("onSiteWidePromotionAddToCart",this.version),this.rememberHiddenPromotion(this.getPromotionKey()),this.hideSiteWideSalePromotion()}}trackSiteWideSaleClose(){this.rememberHiddenPromotion(this.getPromotionKey()),this.hideSiteWideSalePromotion()}trackDotdClose(e){const t=$(e.target);this.rememberHiddenPromotion(t.attr("data-product-external-id")),i.a.hideHeaderNotifier()}rememberHiddenPromotion(e){if(!e)return;const t=this.getHiddenPromotionMap();t[e]=Date.now(),this.storeHiddenPromotionMap(t)}getHiddenPromotionMap(){return JSON.parse(r.a.getItem(c)||"{}")}storeHiddenPromotionMap(e){r.a.setItem(c,JSON.stringify(e))}showSiteWideHeaderSalePromotion(e,t){$("#footer-promo-container").html(""),0==$("#header-site-wide-promo-container").children().length&&$("#header-site-wide-promo-container").append(e?this.getSiteWideHeaderPromoVersionPbook(t):this.getSiteWideHeaderPromoVersionEbook(t)).removeClass("hidden"),this.modifySiteLayoutForSiteWideHeaderPromo()}showSiteWideFooterSalePromotion(e,t){$("#header-site-wide-promo-container").html(""),0==$("#footer-promo-container").children().length&&$("#footer-promo-container").append(e?this.getSiteWideFooterPromoVersionPbook(t):this.getSiteWideFooterPromoVersionEbook(t)).removeClass("hidden"),this.modifySiteLayoutForSiteWideHeaderPromo()}hideSiteWideSalePromotion(){let e=$("#header-site-wide-promo-container").children().length>0||$("#footer-promo-container").children().length>0;$("#header-site-wide-promo-container").html(""),$("#footer-promo-container").html(""),$("#landing-page-content-container, #book-main-content-container").css({"margin-top":0}),e&&$(document).trigger("requestTocPosition")}getSiteWideFooterPromoVersionEbook(e=!1){return`\n        <div class="site-wide-promo site-wide-footer-promo site-wide-promo-version-2 site-wide-footer-promo-ebook site-wide-promo-ebook ${e?"small-promo":""}">\n            <img src="${s.a.getLivebookCdn()}assets/images/mustache-guy.png"/>\n            <span>${a.a.siteWideSaleEbookMessage}</span>\n            <div class="close-side-wide-sale-button"><i class="fa fa-times"></i></div>\n        </div>`}getSiteWideFooterPromoVersionPbook(e=!1){return`<div class="site-wide-promo site-wide-footer-promo site-wide-promo-version-2 site-wide-footer-promo-pbook site-wide-promo-pbook ${e?"small-promo":""}">\n            <img src="${s.a.getLivebookCdn()}assets/images/mustache-guy.png"/>\n            ${a.a.siteWideSaleComboMessage}\n            <div class="close-side-wide-sale-button"><i class="fa fa-times"></i></div>\n        </div>`}getSiteWideHeaderPromoVersionEbook(e=!1){return`\n        <div class="site-wide-promo site-wide-promo-version-1 site-wide-header-promo-ebook site-wide-promo-ebook ${e?"small-promo":""}">\n            <span>${a.a.siteWideSaleEbookMessage}</span>\n            <div class="close-side-wide-sale-button"><i class="fa fa-times"></i></div>\n        </div>`}getSiteWideHeaderPromoVersionPbook(e=!1){return`<div class="site-wide-promo site-wide-promo-version-1 site-wide-header-promo-pbook site-wide-promo-pbook ${e?"small-promo":""}">\n            ${a.a.siteWideSaleComboMessage}\n            <div class="close-side-wide-sale-button"><i class="fa fa-times"></i></div>\n        </div>`}modifySiteLayoutForSiteWideHeaderPromo(){const e=$("#header-site-wide-promo-container").height();$("#landing-page-content-container").css({"margin-top":`${e}px`}),$("#book-main-content-container").css({"margin-top":`${1.25*e}px`}),$(document).trigger("requestTocPosition")}getPromotionKey(){return c}getNextPromoIndex(){const e=r.a.getItem("PROMO_VERSION_KEY");let t=e?+e:0;return++t>8&&(t=1),r.a.setItem("PROMO_VERSION_KEY",t),t}}const h=new d},337:function(e,t,o){"use strict";o.d(t,"a",(function(){return l}));var i=o(2),n=o(0),r=o(4),a=o(3),s=o(9);const l=new class{constructor(){this.loadCodeOnInteraction=this.loadCodeOnInteraction.bind(this),r.a.onPassiveEvent(document.querySelectorAll(".toc-menu-button"),["mouseenter","touchstart","click"],this.loadCodeOnInteraction)}initialize(e,t,o){const i=s.a.shouldTocAutomaticallyOpen(t,o);(null!=this.sourcePromise||i)&&this.getSource().then(({TocIndexMenu:n})=>{n.initialize(e,t,o),i&&n.open()})}loadCodeOnInteraction(e){let t="click"==e.type||n.b.isTouchEventOnTouchDevice(e.type);r.a.offPassiveEvent(document.querySelectorAll(".toc-menu-button"),[e.type],this.loadCodeOnInteraction),this.getSource().then(({TocIndexMenu:o})=>{o.initialize(a.a.book,a.a.bookElement,a.a.bookElement&&a.a.bookElement.shortName),t&&o.open(),r.a.offPassiveEvent(document.querySelectorAll(".toc-menu-button"),t?["mouseenter","touchstart","click"]:[e.type],this.loadCodeOnInteraction)})}clean(){this.sourcePromise&&this.sourcePromise.then(({TocIndexMenu:e})=>e.clean())}partialClean(){this.sourcePromise&&this.sourcePromise.then(({TocIndexMenu:e})=>e.partialClean())}getSource(){return this.sourcePromise||(i.a.loadMustacheCode(),i.a.loadVelocityCode(),r.a.offPassiveEvent(document.querySelectorAll(".toc-menu-button"),["mouseenter","touchstart","click"],this.loadCodeOnInteraction),this.sourcePromise=i.a.importWebpackModuleWithRetry(this.constructSourcePromise)),this.sourcePromise}close(){null!=this.sourcePromise&&this.sourcePromise.then(({TocIndexMenu:e})=>{e.close()})}constructSourcePromise(){return Promise.all([o.e(13),o.e(87)]).then(o.bind(null,474))}}},339:function(e,t,o){"use strict";o.d(t,"a",(function(){return a}));var i=o(4),n=o(0),r=o(2);const a=new class{constructor(){this.loadCodeOnInteraction=this.loadCodeOnInteraction.bind(this),i.a.onPassiveEvent(document.querySelectorAll("#book-additional-commands-container"),["mouseenter","touchstart","click"],this.loadCodeOnInteraction)}initialize(){this.sourcePromise&&this.sourcePromise.then(({BookElementAdditionalCommandsMenu:e})=>{e.initialize()})}clean(){this.sourcePromise&&this.sourcePromise.then(({BookElementAdditionalCommandsMenu:e})=>{e.clean()})}hideFor(e){this.sourcePromise&&this.sourcePromise.then(({BookElementAdditionalCommandsMenu:t})=>{t.hideFor(e)})}openMenu(){this.getSource().then(({BookElementAdditionalCommandsMenu:e})=>{e.openMenu()})}closeMenu(){this.sourcePromise&&this.sourcePromise.then(({BookElementAdditionalCommandsMenu:e})=>{e.closeMenu()})}loadCodeOnInteraction(e){let t="click"==e.type||n.b.isTouchEventOnTouchDevice(e.type);i.a.offPassiveEvent(document.querySelectorAll("#book-additional-commands-container"),[e.type],this.loadCodeOnInteraction),this.getSource().then(({BookElementAdditionalCommandsMenu:o})=>{o.initialize(),t&&o.openMenu(),i.a.offPassiveEvent(document.querySelectorAll("#book-additional-commands-container"),t?["mouseenter","touchstart","click"]:[e.type],this.loadCodeOnInteraction)}),e&&e.stopImmediatePropagation()}getSource(){return this.sourcePromise||(this.sourcePromise=r.a.importWebpackModuleWithRetry(this.constructSourcePromise)),this.sourcePromise}constructSourcePromise(){return o.e(26).then(o.bind(null,681))}}},405:function(e,t,o){"use strict";o.d(t,"a",(function(){return a}));var i=o(2),n=o(0),r=o(3);const a=new class{promote(){this.shouldDoPromotions()&&(r.a.isSiteWideSaleEnabled||r.a.isDotdSaleEnabled)&&this.getPromoSource().then(({PromoManager:e})=>{r.a.isSiteWideSaleEnabled?e.promoteSitewideSale():r.a.isDotdSaleEnabled&&e.promoteDotd()})}clean(){this.shouldDoPromotions()&&this.getPromoSource().then(({PromoManager:e})=>{e.clean()})}getPromoSource(){return this.promoSourcePromise||(this.promoSourcePromise=i.a.importWebpackModuleWithRetry(this.constructPromoSourcePromise)),this.promoSourcePromise}constructPromoSourcePromise(){return o.e(68).then(o.bind(null,336))}shouldDoPromotions(){return!n.b.isApp()}}},406:function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var i=o(2);const n=new class{initialize(e,t){this.getSource().then(({BookResourcesMenu:o})=>o.initialize(e,t))}clean(){this.getSource().then(({BookResourcesMenu:e})=>e.clean())}requestOpen(){this.getSource().then(({BookResourcesMenu:e})=>e.open())}getSource(){return this.sourcePromise||(i.a.loadMustacheCode(),i.a.loadVelocityCode(),this.sourcePromise=i.a.importWebpackModuleWithRetry(this.constructSourcePromise)),this.sourcePromise}constructSourcePromise(){return o.e(28).then(o.bind(null,679))}}},407:function(e,t,o){"use strict";o.d(t,"a",(function(){return r}));var i=o(5),n=o(337);const r=new class{constructor(){$(document).on("fullscreenchange",e=>{this.setZenMode(null!=document.fullscreenElement)})}initialize(){}toggleZenMode(){const e=!$(document.body).is(".zen-mode");this.setZenMode(e),$(document).trigger("zenModeToggle",e)}setZenMode(e){this.zen=e,$(document.body).toggleClass("zen-mode",this.zen),$(document).trigger("zen-mode-change",this.zen),this.zen?this.enterFullScreen():this.exitFullScreen(),this.zen&&n.a.close(),$(".book-element-additional-commands-zen-item").toggleClass("active",e),i.a.setItem("ZEN_MODE",this.zen)}enterFullScreen(){try{document.documentElement.requestFullscreen()}catch(e){}}exitFullScreen(){if(null!=document.fullscreenElement)try{document.exitFullscreen&&document.exitFullscreen()}catch(e){}}}},582:function(e,t,o){"use strict";o.d(t,"a",(function(){return c}));var i=o(0),n=o(1),r=o(184);class a{syncWithServer(e){return new Promise((t,o)=>{n.a.postToOurBackend(n.a.getAbsoluteUrl("api/events/syncReadingData"),()=>t(),e=>o(e),{items:e},!0,!0,!1,!0)})}logReading(e,t,o,i,a,s,l,c,d,h,u,m){return new Promise((g,p)=>{r.a.isVisible().then(r=>{r&&n.a.postToOurBackend(n.a.getAbsoluteUrl("api/events/view"),e=>g(e),e=>p(e),{bookShortName:e,element:t,elementPosition:o,bookSectionNumber:i,userOwnsBook:a,meapVersion:l,manningId:c,sessionId:d,readLogIntervalDuration:h,isOpenChapter:s,sisterLicenseId:u,associatedLicenseId:m})})})}}var s=o(8);class l{constructor(e){this.webService=e}syncWithServer(e){return new Promise((t,o)=>{this.getItemsMap().then(i=>{null!=(e=e||this.getReadingLogItemsFromItemsMap(i))&&e.length>0?this.webService.syncWithServer(e).then(()=>{this.saveItemsMap({}),t()}).catch(e=>o(e)):t()}).catch(e=>o(e))})}logReading(e,t,o,n,r,a,s,l,c,d,h,u){return i.b.isConnected()?this.webService.logReading(e,t,o,n,r,a,s,l,c,d,h,u):this.storeItem(e,t,o,n,r,s,l,c,d)}storeItem(e,t,o,n,r,a,l,c,d){return new Promise((t,o)=>{this.getItemsMap().then(o=>{const n=s.a.getTodaysDateAsString();o[n]||(o[n]={}),o[n][e]?o[n][e].numberOfTicks++:o[n][e]={bookShortName:e,date:n,manningId:l,numberOfTicks:1,readLogIntervalDuration:d,userOwnsBook:r,platform:i.b.getPlatformAndOsString()},this.saveItemsMap(o).then(()=>t())}).catch(e=>o(e))})}getItemsMap(){return new Promise((e,t)=>{this.getUtils().readFile(this.getUtils().getReadingLogLocation()).then(t=>e(JSON.parse(t||"{}"))).catch(e=>t(e))})}saveItemsMap(e){return this.getUtils().writeToFile(this.getUtils().getReadingLogLocation(),JSON.stringify(e))}getReadingLogItemsFromItemsMap(e){const t=[];for(const o in e)for(const i in e[o])t.push(e[o][i]);return t}getUtils(){return window.fileSystemUtils}}const c=new class{constructor(){this.servicePromise=new Promise((e,t)=>{i.b.loadDeviceInfo().then(t=>{e(function(e){const t=new a;switch(e){case i.a.Cordova:case i.a.Electron:return new l(t);case i.a.Browser:default:return t}}(t.platform))}).catch(e=>t(e))})}syncWithServer(){return new Promise((e,t)=>{this.servicePromise.then(o=>{o.syncWithServer().then(t=>e(t)).catch(e=>t(e))})})}logReading(e,t,o,i,n,r,a,s,l,c,d,h){return new Promise((u,m)=>{this.servicePromise.then(g=>{g.logReading(e,t,o,i,n,r,a,s,l,c,d,h).then(e=>u(e)).catch(e=>m(e))})})}}},770:function(e,t,o){var i=o(88),n=o(771);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);var r={insert:"head",singleton:!1};i(n,r);e.exports=n.locals||{}},771:function(e,t,o){(t=o(89)(!1)).push([e.i,"#book-markup-container .inline-promo-container{padding:22px;font-family:Lato,-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-weight:400;display:flex;flex-direction:column;align-items:center;border-radius:5px;margin:2em 8%;position:relative;background-color:#ECECEC;color:#222}@media screen and (max-width: 380px){#book-markup-container .inline-promo-container{padding:7px}}#book-markup-container .add-to-cart-inline-promo{background-color:#39c2e3;background-image:url(https://d19npu3b8zepp3.cloudfront.net/assets/images/mustache-guy.png);background-repeat:no-repeat;background-position:bottom left;color:white}@media screen and (max-width: 780px){#book-markup-container .combo-inline-promo{background-image:none}}@media screen and (max-width: 610px){#book-markup-container .ebook-inline-promo{background-image:none}}#book-markup-container .inline-book-info-container{background-color:#5FACBE;color:#DAEBF0}#book-markup-container .inline-book-info-container .inline-book-info-welcome-container{color:white;font-size:110%}#book-markup-container .inline-book-info-container{flex-direction:row;align-items:flex-start}#book-markup-container .inline-book-info-container p{margin-top:12px;margin-bottom:0;line-height:26px;padding:0}#book-markup-container .inline-book-info-container p a{color:inherit;text-decoration:underline}#book-markup-container .inline-book-info-container p a:visited{color:inherit}@media screen and (max-width: 770px){#book-markup-container .inline-book-info-container p{font-size:14px;margin-bottom:0}}#book-markup-container .inline-book-info-cover-container{margin:-22px 22px -22px -22px}#book-markup-container .inline-book-info-cover-container img{max-width:140px;border-radius:5px 0 0 5px}@media screen and (max-width: 700px){#book-markup-container .inline-book-info-cover-container img{max-width:150px}}#book-markup-container .inline-promo-title{font-size:110%;margin-bottom:12px;text-align:center}#book-markup-container .inline-promo-button{background-color:#5FACBE;border-radius:5px;box-shadow:0 2px 4px 0 rgba(0,0,0,0.04);display:block;width:100%;height:44px;max-width:200px;line-height:44px;color:white;user-select:none;cursor:pointer;text-align:center;white-space:nowrap}#book-markup-container .inline-promo-button.inline-promo-cart-button{max-width:260px}#book-markup-container .inline-promo-button .add-to-cart-content-list-book-price{color:#DAEBF0}#book-markup-container .inline-promo-button .add-to-cart-content-list-book-price::before{border-top-color:#DAEBF0}#book-markup-container .inline-promo-button:hover{background-color:#4da3b7}#book-markup-container .inline-promo-button:active{background-color:#4494a6}#book-markup-container .inline-promo-button.inline-promo-cart-button{background-color:#407fbf}#book-markup-container .inline-promo-button.inline-promo-cart-button:hover{background-color:#3a72ac}#book-markup-container .inline-promo-button.inline-promo-cart-button:active{background-color:#369}#book-markup-container .inline-promo-button.inline-promo-checkout{background-color:#67a73d}#book-markup-container .inline-promo-button.inline-promo-checkout:hover{background-color:#5b9436}#book-markup-container .inline-promo-button.inline-promo-checkout:active{background-color:#50822f}@media screen and (max-width: 620px){#book-markup-container .inline-book-info-cover-container{display:none}}\n",""]),e.exports=t}}]);
//# sourceMappingURL=bookPage.chunk.js.map?5cb960196e3a713f0286