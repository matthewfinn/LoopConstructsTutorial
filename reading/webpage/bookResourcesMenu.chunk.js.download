(window.webpackJsonp=window.webpackJsonp||[]).push([[28,87],{1146:function(e,o,n){var t=n(88),r=n(1147);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var s={insert:"head",singleton:!1};t(r,s);e.exports=r.locals||{}},1147:function(e,o,n){(o=n(89)(!1)).push([e.i,"#book-resources-menu{width:320px}#book-resources-menu .book-resources-links-container{font-size:14px;margin-bottom:10px}#book-resources-menu .book-resources-links-container .fa-star{color:#fc0}#book-resources-menu .book-resources-links-container .book-resource-link{display:block;padding:10px 15px}#book-resources-menu .book-resources-links-container .book-resource-link:hover{color:#222222;background-color:#cccccc}#book-resources-menu .book-resources-links-container:last-of-type{margin-bottom:0}\n",""]),e.exports=o},115:function(e,o,n){"use strict";var t=n(35),r=n(1),s=n(118);const i=window.fileSystemUtils;o.a=window.fsa=new class{constructor(){}getBookElementFileNames(e){return i.getFolderChildren(`${i.getBooksContentFolderLocation()}/${e}/Content/`)}unzipBook(e,o){return new Promise((n,t)=>{i.unzipFile(e,i.getBookContentFolderLocation(o)).then(()=>{i.deleteFileIfExists(e),i.createFolderIfNecessary(i.getBookUserDataFolderLocation(o)).then(()=>{console.log("Unzipped",i.getBooksContentFolderLocation()),s.a.buildAndSaveBookIndex(o),n()}).catch(e=>t(e))}).catch(o=>{i.deleteFileIfExists(e),t(o)})})}unzipBookExercises(e,o){const n=e.replace(".zip","-exercises.zip");i.fileExists(n).then(e=>{e&&i.unzipFile(n,i.getBookContentFolderLocation(o))}).catch(e=>console.log("Error when unzipping exercises"))}cancelBookDownload(e){i.cancelDownload(`${e}.zip`)}requestBookDownload(e,o,n,t){const s=i.getTempDownloadLocation(`${e}.zip`);function a(o){document.dispatchEvent(new CustomEvent("download-error",{detail:{bookShortName:e,bookTitle:n,error:o}}))}i.deleteFileIfExists(s),r.a.postToOurBackend(r.a.getAbsoluteUrl("api/book/getOfflineContentDownloadLink"),o=>{o.contentLink?i.downloadFile(o.contentLink,`${e}.zip`,{bookShortName:e,bookTitle:n,directory:i.getTempDownloadLocation("")}):a(`Error getting offline content download link: ${o.message}`)},e=>a(`Error getting offline content download link: ${e}`),{bookShortName:e,type:o,reviewVersion:t})}cancelDownload(e){i.cancelDownload(e)}deleteBook(e){return i.deleteFolderIfExists(i.getBookContentFolderLocation(e))}loadBook(e){return new Promise((o,n)=>{i.fileExists(i.getBookInfoLocation(e)).then(t=>{if(t)return i.readFile(i.getBookInfoLocation(e)).then(e=>{const n=JSON.parse(e);n.hasBeenDownloaded=!0,o(n)});n(null)}).catch(e=>n(e))})}getBookElementPdfContentLocation(e,o){return i.getBookElementPdfContentLocation(e,o)}loadBookContent(e,o,n){return new Promise((r,s)=>{i.fileExists(i.getBookInfoLocation(e)).then(a=>{if(!a)return void s(null);const c=[i.readFile(i.getBookInfoLocation(e)),i.readFile(i.getBookElementContentLocation(e,o))];Promise.all(c).then(s=>{const a=JSON.parse(s[0]),c=()=>{const n=t.a.convertToBookContent(a,o,i.getBookElementAudioLocation(e,o),i.getBookElementSubtitlesLocation(e,o),this.fixImageUrls(s[1]));n.book.hasBeenDownloaded=!0,n.bookElement&&n.bookElement.pdf&&(n.bookElement.content=i.getBookElementPdfContentLocation(e,o)),r(n)};a.bookElements&&0!=a.bookElements.length||null==n?c():n(e,void 0,!0).then(o=>{o.bookElements?(a.bookElements=o.bookElements,i.writeToFile(i.getBookInfoLocation(e),JSON.stringify(a)),c()):c()}).catch(e=>c())}).catch(e=>s(e))}).catch(e=>s(e))})}fixImageUrls(e){return e.replace(/\{\{BOOK_ROOT_FOLDER\}\}/g,i.getBooksContentFolderLocation())}loadLibrary(){return new Promise((e,o)=>{i.getFolderChildren(i.getBooksContentFolderLocation()).then(o=>{o.map(e=>`${i.getBooksContentFolderLocation()}${e}/`);return Promise.all(o.map(e=>i.readFile(i.getBookInfoLocation(e)))).then(o=>{const n=[];for(let e=0;e<o.length;e++){const s=o[e],a=t.a.convertToBook(JSON.parse(s));a.hasBeenDownloaded=!0,a.bookCoverPath=i.getBookCoverPath(a.shortName),a.bookPath=r.a.getBookUrlFromBook(a),n.push(a)}e(n)}).catch(o=>{e([])})})})}saveLibrary(e){}loadTocAndIndex(e){return new Promise((o,n)=>{i.readFile(i.getTocAndIndexLocation(e.shortName)).then(e=>{if(!e)return void o({});const n=JSON.parse(e);"string"==typeof n.toc&&(n.toc=JSON.parse(n.toc)),"string"==typeof n.index&&(n.index=JSON.parse(n.index)),o(n)}).catch(e=>{o({})})})}loadVideos(e){const o=e.book.shortName;return new Promise((n,t)=>{i.readFile(i.getVideosLocation(o,e.shortName)).then(e=>{if(!e)return void n({});const t=JSON.parse(e);if(t instanceof Object)for(let e in t)t.hasOwnProperty(e)&&(t[e].video=`${i.getBookContentFolderLocation(o)}/Videos/${t[e].video}`);n(t)}).catch(e=>{console.log(e,"When loading videos"),n({})})})}fetchRunnableListing(e,o){return new Promise((n,t)=>{i.readFile(this.getRunnableListingLocation(e,o)).then(e=>n(e)).catch(e=>t(e))})}getRunnableListingLocation(e,o){return i.getRunnableListingLocation(e,o)}failSafeRead(e){return new Promise((o,n)=>{i.readFile(e).then(e=>o(e)).catch(()=>o(""))})}}},118:function(e,o,n){"use strict";n.d(o,"a",(function(){return r}));var t=n(2);const r=new class{buildAndSaveBookIndex(e){this.getSearchFallbackProviderSource().then(({SearchFallbackProvider:o})=>o.buildAndSaveBookIndex(e))}getSearchFallbackProviderSource(){return this.searchFallbackSourcePromise||(this.searchFallbackSourcePromise=t.a.importWebpackModuleWithRetry(this.constructSearchFallbackSourcePromise)),this.searchFallbackSourcePromise}constructSearchFallbackSourcePromise(){return Promise.all([n.e(17),n.e(103),n.e(73)]).then(n.bind(null,159))}}},135:function(e,o,n){"use strict";n.d(o,"a",(function(){return c}));var t=n(1);class r{getAccessibleResources(e){return new Promise((o,n)=>{t.a.postToOurBackend(t.a.getAbsoluteUrl("api/catalog/getAccessibleResources"),n=>{const r=n.downloads||[];r&&r.length&&(r.sort((e,o)=>e.ordinal-o.ordinal),r.forEach(e=>{e.url&&!e.url.startsWith("http")&&(e.url=t.a.getMarketplaceS3Url(e.url))}));const s=n.restrictedDownloads||[];s&&s.length&&s.forEach(o=>{o.linkText=o.restrictedDownloadType||o.description||o.productFormat,"SOURCE_CODE"==o.linkText&&(o.linkText="Source Code"),(!o.url||o.url.indexOf("restrictedDownload")>=0)&&(o.url=t.a.getProductionMarketplaceUrl(`dashboard/download?restrictedDownloadId=${o.id}`),o.url+=`&productExternalId=${e}`,o.licenseId&&(o.url+=`&licenseId=${o.licenseId}`))}),o(n)},e=>o(null),{bookShortName:e})})}getTocAndIndex(e,o,n){let r="";return r=o?`/${e.shortName}/v-${o}/tocAndIndex.json`:n?`/${e.shortName}/r-${n}/tocAndIndex.json`:`/${e.shortName}/tocAndIndex.json`,new Promise((e,o)=>{$.ajax({url:t.a.getAwsUrl(r),dataType:"json"}).then(o=>{"string"==typeof o&&(o=JSON.parse(o)),"string"==typeof o.index&&(o.index=JSON.parse(o.index)),"string"==typeof o.toc&&(o.toc=JSON.parse(o.toc)),e(o)}).fail(e=>o(e))})}}var s=n(115),i=n(0);class a{constructor(){this.webService=new r}getTocAndIndex(e,o,n){return e&&e.hasBeenDownloaded?s.a.loadTocAndIndex(e):this.webService.getTocAndIndex(e,o,n)}getAccessibleResources(e){return i.b.isConnected()?this.webService.getAccessibleResources(e):Promise.resolve({downloads:[],restrictedDownloads:[],productUrls:[{linkText:"Manning book page",url:"https://manning.com/"+e}]})}}const c=new class{constructor(){this.tocAndIndexPromiseMap={},this.bookResourcesServicePromise=new Promise((e,o)=>{i.b.loadDeviceInfo().then(o=>{e(function(e){switch(e){case i.a.Browser:return new r;case i.a.Cordova:case i.a.Electron:return new a}}(o.platform))}).catch(e=>o(e))})}getTocAndIndex(e,o,n){if(!e)return Promise.reject({});const t=o&&n&&n.meapVersion||0,r=o&&n&&n.reviewVersion||0,s=`${e}-${t}-${r}`;return this.tocAndIndexPromiseMap[s]?this.tocAndIndexPromiseMap[s]:this.tocAndIndexPromiseMap[s]=new Promise((e,n)=>{this.bookResourcesServicePromise.then(s=>{s.getTocAndIndex(o,t,r).then(o=>e(o)).catch(e=>n(e))}).catch(e=>n(e))})}getAccessibleResources(e){return e?this.previousResourcesBookShortName==e&&this.bookResourcesPromise?this.bookResourcesPromise:(this.previousResourcesBookShortName="",this.bookResourcesPromise=new Promise((o,n)=>{this.bookResourcesServicePromise.then(t=>{t.getAccessibleResources(e).then(n=>{this.previousResourcesBookShortName=e,o(n)}).catch(e=>{this.bookResourcesPromise=null,n(e)})}).catch(e=>n(e))})):Promise.resolve(null)}reset(){this.bookResourcesPromise=null,this.previousResourcesBookShortName=""}}},169:function(e,o,n){"use strict";var t=n(1),r=n(14),s=n(29),i=n(8),a=n(6),c=n(0),l=n(28);o.a=new class{getTokenCountInfo(e=!1){return e||null==this.currentTokenCountInfo?e||null==this.currentTokenCountInfoPromise?this.currentTokenCountInfoPromise=new Promise((o,n)=>{a.a.isLoggedIn(e).then(e=>{e.loggedIn&&e.userDetails.tokenInfo?(this.currentTokenCountInfo=e.userDetails.tokenInfo,o(e.userDetails.tokenInfo)):(this.currentTokenCountInfoPromise=null,n("No token count info"))}).catch(e=>n(e))}):this.currentTokenCountInfoPromise:Promise.resolve(this.currentTokenCountInfo)}setTokenCountInfo(e){this.currentTokenCountInfo=e,r.a.setTokenInfo(e)}getTokenLedgerItems(e=!1){return c.b.isApp()&&!c.b.isConnected()?Promise.resolve([]):a.a.isCurrentlyLoggedIn()?e&&this.lastTokenLedger?Promise.resolve(this.lastTokenLedger):new Promise((e,o)=>{t.a.getFromOurBackend(t.a.getAbsoluteUrl("api/token/getTokenLedger"),o=>{const n=o.map(e=>{return{date:i.a.getDateFromString(e.date),quantity:e.quantity,description:e.description,notes:e.notes,link:l.a.adjustBookLink(e.link),isFreeTokensRedemption:"COMPED"==e.type}});this.lastTokenLedger=n,e(n)},e=>{o("Error getting token ledger")})}):Promise.resolve([])}getTokenCashoutInfo(){return new Promise((e,o)=>{t.a.getFromOurBackend(t.a.getAbsoluteUrl("api/token/getCashoutInfo"),o=>{o&&o.tokenCount&&(this.setTokenCountInfo(o.tokenCount),s.a.refreshTokenStateInToolbar(o.tokenCount)),e(o)},e=>o("Error getting token ledger"))})}cashout(){return new Promise((e,o)=>{t.a.getFromOurBackend(t.a.getAbsoluteUrl("api/token/cashout"),o=>{o&&o.tokenCount&&(this.setTokenCountInfo(o.tokenCount),s.a.refreshTokenStateInToolbar(o.tokenCount)),e(o)},e=>o("Error performing token cashout"))})}}},679:function(e,o,n){"use strict";n.r(o),n.d(o,"BookResourcesMenu",(function(){return l}));var t=n(1),r=n(41),s=n(169),i=n(135),a=(n(1146),n(0));const c='<label class="section-menu-header">{{label}}</label> \n<div class="book-resources-links-container">\n    {{#items}}\n        <a class="book-resource-link" href="{{url}}" target="{{#isSelf}}_self{{/isSelf}}{{^isSelf}}_blank{{/isSelf}}" title="{{title}}">\n            {{linkText}} {{#isStarred}}<i class="fa fa-star" aria-hidden="true"></i>{{/isStarred}}\n        </a>\n    {{/items}}\n</div>',l=new class{constructor(){$(document.body).append('<div id="book-resources-menu" class="slide-in-menu slide-in-menu-right closed"><div class="slide-in-menu-container"></div></div>'),this.$bookResourcesButton=$(".book-resources-menu-button"),this.$bookResourcesMenu=$("#book-resources-menu"),this.handleMenuOpening=this.handleMenuOpening.bind(this),this.slideMenu=new r.a(this.$bookResourcesButton,this.$bookResourcesMenu,this.handleMenuOpening),$(document).on("requestBookResourceMenuOpen",()=>this.open())}initialize(e,o){e&&(this.currentBook=e,this.currentBookElement=o)}handleMenuOpening(){this.hasBeenRendered||(this.$bookResourcesMenu.find(".slide-in-menu-container").html('<div class="loading-container">\n                <i class="fal fa-spin fa-circle-notch fa-3x fa-fw"></i>\n            </div>'),this.currentBook&&this.currentBookElement&&(this.currentBook.manningId?Promise.all([i.a.getAccessibleResources(this.currentBook.shortName),s.a.getTokenLedgerItems(!0)]).then(e=>{const o=e&&e[0],n=e&&e[1];if(this.hasBeenRendered=!0,!o)return;let r="",s=o.productUrls||[];const i=o.meapVersions||[],l=o.reviewVersions||[];if(s=s.filter(e=>"FORUM"!=(e.type||"")),this.currentBook){for(const e of i)if(e&&e.version>0){const o=`MEAP V${e.version}`;if(null==s.find(e=>e.linkText==o)){const r=this.tokenLedgerContains(n,this.currentBook.slug,e.version);s.push({linkText:o,url:t.a.getBookElementUrl(this.currentBook.slug,"chapter-1",e.version),isStarred:r,title:r?"contains owned content":""})}}for(const e of l)if(e&&e.version>0){const o=`REVIEW R${e.version}`;null==s.find(e=>e.linkText==o)&&s.push({linkText:o,isSelf:a.b.isApp(),url:t.a.getBookElementUrl(this.currentBook.slug,"chapter-1",null,e.version),isStarred:!1,title:""})}}const u=o.downloads||[],d=o.restrictedDownloads||[];for(const e of d)e.url&&e.productFormat&&(e.linkText="download "+e.linkText+" from dashboard",e.url="https://www.manning.com/dashboard");null!=u&&u.length>0&&(r+=Mustache.render(c,{label:"downloads",items:u.concat(d.filter(e=>e.url))})),s&&s.length&&(r+=Mustache.render(c,{label:"links",items:s})),this.$bookResourcesMenu.find(".slide-in-menu-container").html(r)}).catch(e=>{this.hasBeenRendered=!1}):$(".book-resources-menu-button").addClass("hidden")),this.hasBeenRendered=!0)}clean(){this.currentBook=null,this.currentBookElement=null,$(".book-resources-menu-button").removeClass("hidden"),this.$bookResourcesMenu.find(".slide-in-menu-container").empty(),this.hasBeenRendered=!1}open(){this.slideMenu&&this.slideMenu.openMenu()}close(){this.slideMenu&&this.slideMenu.closeMenu()}tokenLedgerContains(e,o,n){return null!=e&&0!=e.length&&null!=e.find(e=>null!=e.link&&-1!=e.link.indexOf("/"+o+"/")&&-1!=e.link.indexOf("/v-"+n))}}}}]);
//# sourceMappingURL=bookResourcesMenu.chunk.js.map?496b9ad3afb9b9b646e6