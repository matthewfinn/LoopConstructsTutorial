(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{121:function(e,o,t){"use strict";var r;t.d(o,"a",(function(){return r})),t.d(o,"b",(function(){return n})),function(e){e[e.Default=0]="Default",e[e.Search=1]="Search",e[e.Point=2]="Point",e[e.Paragraphs=3]="Paragraphs",e[e.Subsection=4]="Subsection",e[e.Section=5]="Section",e[e.BookElement=6]="BookElement",e[e.FreePreview=7]="FreePreview"}(r||(r={}));const n=new class{markParagraphsForUnscrambling(e){e.forEach(e=>{e.find(".scrambled-notifier").remove(),e.addClass("unscrambling"),e.removeClass("unscramble-target")})}adaptReadableTextContentForUnscrambling(e){e.forEach(e=>{if(e.attr("data-original-html",e.html()),1===e.children().length&&1===e.children("p").length){const o=e.children("p");o.html(`<div class="scrambled-content-container">${o.html()}</div>\n                     <div class="unscrambled-content-container"></div>`)}else e.html(`<div class="scrambled-content-container">${e.html()}</div>\n                     <div class="unscrambled-content-container"></div>`)})}resetUnscrambledElements(e){e.forEach(e=>{e.html(e.attr("data-original-html")),e.attr("data-original-html",""),e.removeClass("unscrambling")})}getDataFromPointingLink(e,o,t){if(!e||!o||!t||t.length<2)return null;const r={bookShortName:e.shortName,bookElementShortName:o.shortName,paragraphId:void 0,paragraphFingerprint:void 0,pointingLinkId:void 0,paragraphsToUnlock:void 0,startParagraphId:void 0,endParagraphId:void 0,meapVersion:o.meapVersion||0,isUserEditorLink:!1};if(2==t.length?(r.paragraphId=t[0],r.paragraphFingerprint=t[1],r.startParagraphId=parseInt(t[0]),r.endParagraphId=parseInt(t[0])):(r.pointingLinkId=t[0],r.startParagraphId=parseInt(t[1]),r.endParagraphId=parseInt(t[2]),r.isUserEditorLink="1"===t[3]),Number.isNaN(r.startParagraphId)||Number.isNaN(r.endParagraphId))return null;if(r.startParagraphId>r.endParagraphId){let e=r.startParagraphId;r.startParagraphId=r.endParagraphId,r.endParagraphId=e}return r}isEncompassingWholeContent(e,o){if("1"!=e)return!1;try{const e=document.querySelector(`[refid="${o}"]`),t=document.querySelector(`[refid="${+o+1}"]`);return null!=e&&null==t}catch(e){return!1}}replaceEncryptedContent(e,o){return o&&o.forEach(o=>{const t=e.find("[refid='"+o.paragraphID+"']");t.is(".scrambled")&&t.html(o.content).removeClass("scrambled").addClass("unscrambled")}),e.html()}}},61:function(e,o,t){"use strict";t.r(o),t.d(o,"BookContentServiceWeb",(function(){return l}));var r=t(1),n=t(121),a=t(13),s=t(50),i=t(0);const l=new class{getDownloadableBooksShortNames(){return new Promise((e,o)=>{r.a.postToOurBackend(r.a.getAbsoluteUrl("api/userInfo/getDownloadableBooksShortNames"),o=>e(o),o=>{console.log("Error when getDownloadableBooksShortNames"),e([])})})}getGeneralProducts(e){return new Promise((o,t)=>{r.a.postToOurBackend(r.a.getAbsoluteUrl("api/catalog/getProductsDetails"),e=>o(e),e=>t(e),{slugs:e.join(",")})})}getCompleteBookElementPriceInfo(e,o,t){return e&&o?new Promise((n,a)=>{r.a.postToOurBackend(r.a.getAbsoluteUrl("api/userBook/getBookElementStructurePrices"),e=>n(e),e=>a(e),{bookShortName:e,bookElementShortName:o,meapVersion:t||0})}):Promise.reject()}getBookElementTokenPrice(e,o,t){return new Promise((n,a)=>{r.a.postToOurBackend(r.a.getAbsoluteUrl("api/userBook/getBookElementTokenPrice"),e=>n(e.tokenPrice),e=>a(e),{bookShortName:e,bookElementShortName:o,meapVersion:t})})}getTocOwnership(e){return new Promise((o,t)=>{r.a.getFromOurBackend(r.a.getAbsoluteUrl("api/userBook/getOwnedStructure"),e=>o(e),e=>t(e),{bookShortName:e})})}getChapterOwnership(){return null!=this.chapterOwnershipPromise?this.chapterOwnershipPromise:this.chapterOwnershipPromise=new Promise((e,o)=>{r.a.postToOurBackend(r.a.getAbsoluteUrl("api/userBook/getBookChaptersPartialOwnership"),o=>e(o),e=>o(e))})}getRelatedProducts(e){return new Promise((o,t)=>{r.a.postToOurBackend(r.a.getAbsoluteUrl("api/book/getRelatedProducts"),e=>o(e),e=>t(e),{bookShortName:e})})}getCustomersAlsoBoughtProducts(e){return new Promise((o,t)=>{r.a.postToOurBackend(r.a.getAbsoluteUrl("api/cart/getCustomersAlsoBoughtProducts"),e=>o(e),e=>t(e),{bookShortName:e})})}getBook(e,o,t){const n={};return e&&(n.bookShortNameOrSlug=e),o&&(n.productId=o),new Promise((e,o)=>{r.a.postToOurBackend(r.a.getAbsoluteUrl("api/book/getBook"),o=>e(o),e=>o(e),n)})}getBookElementIntro(e,o="",t=""){return new Promise((n,a)=>{r.a.getFromOurBackend(r.a.getAbsoluteUrl("api/book/getBookElementIntro"),e=>{try{n(this.fixUrls(e&&e.intro||""))}catch(o){console.log("Error fixing intro html"),n(e&&e.intro||"")}},e=>a(e),{bookShortNameOrSlug:e,bookElement:o,meapVersion:t||void 0})})}getBookElement(e,o="",t="",n=""){return new Promise((i,l)=>{r.a.getFromOurBackend(r.a.getAbsoluteUrl("api/book/getBookElement"),e=>{if(!1===e.success&&e.reason)return void l(e.reason);const o=e.bookElement,t=e.previousBookElement,r=e.nextBookElement;if(!e.book||!o)return void l("Cannot fetch content");const n=a.a.createBookFromBookData(e.book),s=a.a.createBookElement(o,n,t,r);s.pdf?(s.content=o.contentUrl,i({book:n,bookElement:s,previousBookElement:s.previousBookElement,nextBookElement:s.nextBookElement})):o.content?(s.content=this.adjustContent(o.content,this.fixOwnedContentWithImageUrls(o.ownedContent),n.shortName,n.slug),i({book:n,bookElement:s,previousBookElement:s.previousBookElement,nextBookElement:s.nextBookElement})):(o.intro&&(s.intro=this.adjustContent(o.intro,"",n.shortName,n.slug),$(document).trigger("bookElementIntroArrived",s.intro)),$.ajax({url:o.contentUrl,crossDomain:!0}).done(e=>{s.content=this.adjustContent(e,this.fixOwnedContentWithImageUrls(o.ownedContent),n.shortName,n.slug),i({book:n,bookElement:s,previousBookElement:s.previousBookElement,nextBookElement:s.nextBookElement})}).fail(e=>l(e)))},e=>l(e),{bookShortNameOrSlug:e,bookElementShortName:o,meapVersion:t||void 0,reviewVersion:n||void 0,freeEbooksAreOpen:s.a.isFreeEbookOpen(e)})})}fixOwnedContentWithImageUrls(e){if(!e||!e.length)return e;for(let o=0;o<e.length;o++)e[o].content=this.fixUrls(e[o].content);return e}adjustContent(e,o,t="",r=""){const a=(e=this.fixUrls(e)).indexOf("book-overview-cover-container");if(a>0){const o=e.indexOf("</div>",a);o>a&&(e=e.substring(o+"</div>".length))}return o?(i.b.isApp()&&(e=e.replace(/\/assets\/images\//g,"assets/images/")),n.b.replaceEncryptedContent($("<div></div>").html(e),o)):e}fixUrls(e){return e.replace(/\{\{BOOK_ROOT_FOLDER\}\}/g,r.a.getAwsPublic()).replace(/\#\!\/book\//g,"/book/").replace(/\/\/book\//g,"/book/")}getUserOwnedProducts(){return new Promise((e,o)=>{r.a.postToOurBackend(r.a.getAbsoluteUrl("api/userInfo/getUserOwnedProducts"),o=>{"string"==typeof o&&(o=JSON.parse(o)),e(o)},e=>o(e))})}getSimpleCatalog(){return new Promise((e,o)=>{r.a.getFromOurBackend(r.a.getAbsoluteUrl("api/catalog/getSimpleCatalog"),o=>e(o),e=>o(e))})}getMediumCatalog(){return new Promise((e,o)=>{r.a.getFromOurBackend(r.a.getAbsoluteUrl("api/catalog/getMediumCatalog"),o=>e(o),e=>o(e))})}getCatalog(){return new Promise((e,o)=>{r.a.getFromOurBackend(r.a.getAbsoluteUrl("api/catalog/getCatalog"),o=>e(o),e=>o(e))})}getBestsellers(){return new Promise((e,o)=>{r.a.getFromOurBackend(r.a.getAbsoluteUrl("api/catalog/getBestsellers"),o=>e(o),e=>o(e))})}getUserEditorBooksShortNames(){return new Promise((e,o)=>{r.a.postToOurBackend(r.a.getAbsoluteUrl("api/userInfo/getCurrentUserBookEditorShortNames"),o=>e(o&&o.bookShortNames||""),o=>{console.log("Error when fetching user editor book short names"),e("")})})}requestBookDownload(e,o){throw new Error("Cannot download book on the web")}deleteBook(e){return Promise.reject("Cannot delete book on the web")}unzipBook(e,o){return Promise.reject("Cannot unzip book on the web")}getFreePreviewStatus(e){return new Promise((o,t)=>{r.a.postToOurBackend(r.a.getAbsoluteUrl("freePreview/getFreePreviewStatus"),e=>{o(e)},e=>{console.log("Error when fetching free preview status"),t(e)},{bookShortName:e})})}getBookDates(e){return new Promise((o,t)=>{r.a.postToOurBackend(r.a.getAbsoluteUrl(`api/book/dates/${e}`),e=>o(e),e=>o(""))})}getBooksDetails(e){return new Promise((o,t)=>{r.a.postToOurBackend(r.a.getAbsoluteUrl(`api/catalog/getBooksDetails?bookShortNames=${e.join(",")}`),e=>o(e),e=>t(e))})}getDownloadedBooksShortNamesAndSlugs(){return Promise.resolve({})}markBookAsDownloaded(e,o){return Promise.reject("Cannot download book in browser")}unmarkBookAsDownloaded(e,o){return Promise.reject("Cannot download book in browser")}getEpochHours(){return Math.round(Date.now()/1e3/60/60)}}}}]);
//# sourceMappingURL=bookContentProviderWeb.chunk.js.map?d4ce94517b98d5d4ddc0