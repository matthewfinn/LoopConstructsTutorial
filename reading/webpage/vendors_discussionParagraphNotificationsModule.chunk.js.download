(window.webpackJsonp=window.webpackJsonp||[]).push([[98],{104:function(t,e,o){"use strict";o.d(e,"a",(function(){return n})),o.d(e,"b",(function(){return r}));const n="exercise preview",r="General"},108:function(t,e,o){"use strict";o.d(e,"a",(function(){return m}));var n=o(120),r=o(233),s=o(132),i=o(189),a=o(17),c=o(104);const u="Errata",d="Meeting arrangement",l="Author Online Forum Legacy Posts";class m{static setSourceApp(t){m.sourceApp=t}static setDeploymentType(t){m.deploymentType=t}static getSourceApp(){return m.sourceApp}static getNextEndDate(t,e=0){return t?new Date(t.getTime()-7*Math.pow(2,e)*24*60*60*1e3):new Date(Date.now()-7*Math.pow(2,e)*24*60*60*1e3)}static getProductForumLink(t){if(t.isLivebook){const e=`/book/${t.productSlug}/discussion`;return m.sourceApp==a.b.livebook?e:m.deploymentType==a.a.qa?`https://livebook-qa.manning.com${e}`:`https://livebook.manning.com${e}`}if(t.isLivevideo){const e=`/course/${t.productExternalId}/${t.productSlug}?discussions=true`;return m.sourceApp==a.b.livevideo?e:m.deploymentType==a.a.qa?`https://livevideo-qa.manning.com${e}`:`https://livevideo.manning.com${e}`}if(t.isLiveProject){const e=`/project/${t.productExternalId}/${t.productSlug}?discussions=true`;return m.sourceApp==a.b.pbc?e:m.deploymentType==a.a.qa?`https://liveproject-qa.manning.com${e}`:`https://liveproject.manning.com${e}`}return""}static getElementForumLink(t,e){if(null==t)return"";if(null==e)return m.getProductForumLink(t);if(t.isLivebook){const o=`/book/${t.productSlug}/${e.element}/discussion`;return m.sourceApp==a.b.livebook?o:m.deploymentType==a.a.qa?`https://livebook-qa.manning.com${o}`:`https://livebook.manning.com${o}`}if(t.isLivevideo){if(e.element==c.b||e.element==u||e.element==l||e.element==d)return m.getProductForumLink(t);const o=`/module/${e.element}?discussions=true`;return m.sourceApp==a.b.livevideo?o:m.deploymentType==a.a.qa?`https://livevideo-qa.manning.com${o}`:`https://livevideo.manning.com${o}`}if(t.isLiveProject){if(e.element==c.b||e.element==u||e.element==l||e.element==d)return m.getProductForumLink(t);const o=`/module/${e.element}?discussions=true`;return m.sourceApp==a.b.pbc?o:m.deploymentType==a.a.qa?`https://liveproject-qa.manning.com${o}`:`https://liveproject.manning.com${o}`}return""}static sortProductForums(t,e){e==i.a.Alphabetical?t.sort((t,e)=>t.productTitle<e.productTitle?-1:t.productTitle>e.productTitle?1:0):e==i.a.MostRecent?t.sort((t,e)=>e.lastCommentDate==t.lastCommentDate?0:e.lastCommentDate<t.lastCommentDate?-1:1):e==i.a.CommentCount&&t.sort((t,e)=>e.numberOfComments-t.numberOfComments)}static sortElementForums(t,e){e==i.a.Alphabetical?t.sort((t,e)=>this.compareByTitle(t.element||"",e.element||"")):e==i.a.MostRecent?t.sort((t,e)=>e.lastCommentDate==t.lastCommentDate?0:e.lastCommentDate<t.lastCommentDate?-1:1):e==i.a.CommentCount&&t.sort((t,e)=>e.forum.getCommentCount()-t.forum.getCommentCount())}static compareByTitle(t,e){if(t=(t||"").toLowerCase(),e=(e||"").toLowerCase(),"general"==t)return-1;if("general"==e)return 1;if("errata"==t)return-1;if("errata"==e)return 1;if("meeting arrangement"==t)return-1;if("meeting arrangement"==e)return 1;if(-1!=t.indexOf("chapter")&&-1!=e.indexOf("chapter")){const o=t.match(/\d+/),n=e.match(/\d+/);if(o&&n)return parseInt(o[0])-parseInt(n[0])}else if(-1!=t.indexOf("appendix")&&-1!=e.indexOf("appendix")){const o=t.match(/\d+/),n=e.match(/\d+/);if(o&&n)return parseInt(o[0])-parseInt(n[0])}else{if(-1!=t.indexOf("chapter")&&-1!=e.indexOf("appendix"))return-1;if(-1!=t.indexOf("appendix")&&-1!=e.indexOf("chapter"))return 1}return t<e?-1:t>e?1:0}static getMatchingProductForums(t,e){if(!(e=(e||"").trim()))return t;let o=new r.a(t,{includeScore:!0,shouldSort:!0,threshold:.2,keys:[{name:"productTitle",weight:1}]}).search(e).map(t=>t.item);if(0==o.length){const n=e.toLowerCase();o=t.filter(t=>-1!=t.productTitle.toLowerCase().indexOf(n))}return o}static isAuthor(t,e){return!(!t||!e)&&!!e[t.id]}static isModerator(t,e){return!(!t||!e)&&!!e[t.id]}static updateOnlineStatus(t){this.onlineIdMap=t||{}}static isOnline(t){return!(!t||!this.onlineIdMap)&&this.onlineIdMap[t.id]}static canModerateInProduct(t,e){return!(!t||!t.authorizedProductIds)&&(t.authorizedProductIds["*"]||t.authorizedProductIds[e])}static getUniqueUsers(t){if(!t||!t.length)return[];const e=[],o={};for(const n of t)o[n.user.id]||(e.push(n.user),o[n.user.id]=!0);return e}static hasAlreadyBeenMarkedAsSpam(t,e){return!!(t&&t.spamCommentIds&&t.spamCommentIds.length&&e)&&null!=t.spamCommentIds.find(t=>t==e.id)}static hasProductForumVisitNotifications(t,e){if(!t||!e)return!1;const o=t[e.productId];return!!o&&e.lastCommentDate>o.lastVisitDate}static hasElementForumVisitNotifications(t,e,o){if(!t||!e)return!1;const n=t[e.productId];return!!n&&(!n.visitedElements[o.element]&&o.forum.hasPostsNewerThan(n.lastVisitDate))}static on(t,e){this.emitter.addListener(t,e)}static off(t,e){this.emitter.removeListener(t,e)}static trigger(t,e){setTimeout(()=>this.emitter.emit(t,...e),16)}static addLocationReplacementMapItem(t,e){this.locationReplacementMap[t]=e}static getFromLocationReplacementMap(t){return this.locationReplacementMap[t]||t}static setCurrentLocation(t){this.forumLocation=t}static getCurrentLocation(){return this.forumLocation}static getDefaultForumTitle(){return"Discussion"}static adjustElementTitle(t){return(t||"").replace(/-/," ")}static getNotificationsCount(t){let e=0;for(const o of t)e+=o.countNotSeenPosts();return e}static expendCommentWithUserText(t,e){return t||(t=""),0!=t.indexOf("#")&&0!=t.indexOf("<")&&0!=t.indexOf("`")&&0!=t.indexOf(">")||(t="\r\n\r\n"+t),`${e}: ${t}`}static getMatchingThreads(t,e){const o={},n={},i=[],a=[];for(const t of e){a.push(t),o[t.id]=t;for(const e of t.posts)n[e.id]=t,a.push(e)}const c=new r.a(a,{includeScore:!0,shouldSort:!0,threshold:.6,keys:[{name:"text",weight:1}]}).search(t);for(const t of c){const e=t.item;if(e instanceof s.f)i.push(e);else{const t=n[e.id];t&&i.push(t)}}return i}static getAllThreads(t){const e=[];if(!t)return e;for(const o of t)e.push(...o.threads);return e}static twoForumsShareTheSameRootThread(t,e){return!!(t&&e&&t.threads&&e.threads&&t.threads.length&&e.threads.length)&&t.threads[0].id==e.threads[0].id}static areTwoForumsSame(t,e){return this.areThreadsSame(t.threads,e.threads)}static areForumsSame(t,e){return this.areThreadsSame(this.getAllThreads(t),this.getAllThreads(e))}static areThreadsSame(t,e){if(!t||!e)return!1;if(t.length!=e.length)return!1;const o={};for(const e of t)o[e.id]=e;for(const o of e){const e=t[o.id];if(!e)return!1;if(e.posts.length!=o.posts.length)return!1}return!0}static storeShouldShowLivebooks(t){this.setItemToLocalStorage("DISCUSSION_SHOW_LIVEBOOKS",t?"1":"")}static shouldShowLivebooks(){return!!this.getItemFromLocalStorage("DISCUSSION_SHOW_LIVEBOOKS")}static getTomorrowsDate(){const t=new Date,e=new Date;return e.setDate(t.getDate()+1),e}static getItemFromLocalStorage(t){try{return localStorage.getItem(t)}catch(e){return console.log("Error getting item from local storage",t),""}}static setItemToLocalStorage(t,e){try{return e?localStorage.setItem(t,e):localStorage.removeItem(t)}catch(e){return console.log("Error setting item to local storage",t),""}}}m.locationReplacementMap={},m.emitter=new n,m.shouldScrollToEndOfThreads=!1,m.shouldShowErrata=!0,m.shouldShowGroupChat=!1,m.shouldShowMaximizeButton=!1,m.shouldShowMinimizeButton=!1,m.shouldShowOnlineStatus=!0,m.onlineIdMap={},m.groupId=0,m.paginationStartDate=new Date,m.paginationEndDate=new Date,m.paginationIncrement=0,m.paginationEndDate=m.getNextEndDate()},117:function(t,e,o){"use strict";o.d(e,"a",(function(){return n}));class n{constructor(t){this.configuration=t}isOnline(){return navigator.onLine}ajax(t,e,o,n,r=!1,s=!1,i=!0){this.get(t,t=>e(t),t=>o(t),n,r,s,i)}static getS3FileContent(t,e,o){if(window.fetch)fetch(t,{mode:"cors",method:"get"}).then(t=>{t.text().then(t=>e(t)).catch(t=>o(t))}).catch(t=>o(t));else if(window.$)$.ajax({url:t,crossDomain:!0}).done(t=>e(t)).fail(t=>o(t));else{const n=new XMLHttpRequest;n.open("get",t,!0),n.setRequestHeader("Content-Type","application/html;charset=UTF-8"),n.setRequestHeader("accept","*/*"),n.setRequestHeader("accept-encoding","gzip, deflate, br"),n.setRequestHeader("cache-control","no-cache"),n.setRequestHeader("sec-fetch-dest","empty"),n.setRequestHeader("sec-fetch-mode","cors"),n.setRequestHeader("sec-fetch-site","cross-site"),n.onreadystatechange=()=>{4==n.readyState&&(200==n.status?e&&e(n.responseText):o&&o(status))},n.send()}}get(t,e,o,n,r=!1,s=!1,i=!0){const a=new XMLHttpRequest;n&&n instanceof Object&&!r&&(t+="?"+this.serializeObject(n)),r?a.open("post",t,!0):a.open("get",t,!0),r?a.setRequestHeader("Content-Type","application/json;charset=UTF-8"):a.setRequestHeader("Content-Type","application/text;charset=UTF-8"),s&&(a.withCredentials=!0),a.onreadystatechange=()=>{let t,n;if(4==a.readyState)if(200==(t=a.status)){try{n=i?JSON.parse(a.responseText):a.responseText}catch(t){return void(o&&o(t))}e&&e(n)}else o&&o(t)},r?a.send(JSON.stringify(n)):a.send()}configure(t){this.configuration=t}getAbsoluteLivebookAwsUrl(t){return this.getAbsoluteUrl(this.configuration.aws.livebook,t)}getAbsoluteBackendUrl(t){return this.getAbsoluteUrl(this.configuration.backend.base,t)}getAbsoluteBackendLivebookUrl(t){return this.getAbsoluteUrl(this.configuration.backend.livebook,t)}getAbsoluteBackendLivevideoUrl(t){return this.getAbsoluteUrl(this.configuration.backend.livevideo,t)}getAbsoluteUrl(t,e){let o=t;return o.endsWith("/")||e.startsWith("/")||(o+="/"),o+e}static getAbsoluteLink(t,e){if(!t)return e;if(!e)return t;let o=t;return t.endsWith("/")||e.startsWith("/")?t.endsWith("&")&&e.startsWith("/")&&(o=o.substr(0,o.length-1)):o+="/",o+e}static isLivebookLink(t){return!!t&&-1!=t.indexOf("/book/")}static isLivevideoLink(t){return!!t&&-1!=t.indexOf("module/")}getAwsPublic(t=""){return this.configuration.aws.livebook+(t||"")}serializeObject(t){if(!t)return"";const e=[];for(const o in t)t.hasOwnProperty(o)&&void 0!==t[o]&&e.push(encodeURIComponent(o)+"="+encodeURIComponent(t[o]));return e.join("&")}}},132:function(t,e,o){"use strict";o.d(e,"e",(function(){return n})),o.d(e,"a",(function(){return s})),o.d(e,"b",(function(){return r.a})),o.d(e,"f",(function(){return i.a})),o.d(e,"d",(function(){return a.a})),o.d(e,"g",(function(){return c.a})),o.d(e,"c",(function(){return u}));class n{constructor(t,e,o,n,r,s,i,a,c,u,d,l){this.authorIdMap={},this.moderatorIdMap={},this.productId=t,this.productExternalId=e,this.productMeapVersion=o,this.productTitle=r,this.productSlug=n,this.numberOfComments=s,this.numberOfNewComments=i,this.lastCommentDate=a,this.elementForums=c,this.isLivebook=u,this.isLivevideo=d,this.isLiveProject=l}getAllThreads(){const t=[];for(const e of this.elementForums)t.push(...e.forum.threads);return t}static createCopy(t){const e=new n(t.productId,t.productExternalId,t.productMeapVersion,t.productSlug,t.productTitle,t.numberOfComments,t.numberOfNewComments,t.lastCommentDate,null!=t.elementForums?(t.elementForums||[]).concat([]):null,t.isLivebook,t.isLivevideo,t.isLiveProject);return e.authorIdMap=t.authorIdMap,e.moderatorIdMap=t.moderatorIdMap,e}}var r=o(136);class s{constructor(t,e,o,n,r=0){this.element=t,this.elementTitle=e,this.forum=o,this.lastCommentDate=n,this.numberOfNewComments=r}static createCopy(t){return new s(t.element,t.elementTitle,r.a.createCopy(t.forum),t.lastCommentDate,t.numberOfNewComments)}keepUniqueThreads(){if(!this.forum||!this.forum.threads||0==this.forum.threads.length)return;const t={},e=[];for(const o of this.forum.threads)t[o.id]||(e.push(o),t[o.id]=!0);this.forum.threads=e}}var i=o(156),a=o(137),c=o(157);class u{constructor(t,e,o,n,r){this.productExternalId=t,this.element=e,this.location=o,this.baseLink=n,this.meapVersion=r}}},136:function(t,e,o){"use strict";o.d(e,"a",(function(){return n}));class n{constructor(t,e,o,n,r){this.title=t,this.forumLocation=e,this.threads=o,this.authorIdMap=n||{},this.moderatorIdMap=r||{}}static createCopy(t){return new n(t.title,t.forumLocation,t.threads.concat([]),Object.assign({},t.authorIdMap),Object.assign({},t.moderatorIdMap))}static createCopyWithNewThreads(t,e){return new n(t.title,t.forumLocation,e,Object.assign({},t.authorIdMap),Object.assign({},t.moderatorIdMap))}getCommentCount(){let t=0;for(let e of this.threads)t+=e.posts.length+1;return t}countNotSeenPosts(){let t=0;for(let e of this.threads)t+=e.countNotSeenPosts();return t}hasPostsNewerThan(t){for(const e of this.threads)if(e.hasPostsNewerThan(t))return!0;return!1}containsThreadWithId(t){for(const e of this.threads)if(e.id==t)return!0;return!1}containsThreadOrPostWithId(t){for(const e of this.threads){if(e.id==t)return!0;for(const o of e.posts)if(o.id==t)return!0}return!1}getCommentIds(){const t=[];for(const e of this.threads){t.push(e.id);for(const o of e.posts)t.push(o.id)}return t}}},137:function(t,e,o){"use strict";o.d(e,"a",(function(){return r}));var n=o(107);class r{constructor(t,e,o,r,s,i,a="",c=!0,u=!1,d=!1){this.isBeingEdited=!1,this.isBeingSynced=!1,this.isSyncingVotes=!1,this.isEditingSuggestion=!1,this.id=t,this.text=e,this.user=o,this.votes=r,this.dateCreated=s,this.dateUpdated=i,this.link=n.a.adaptLinkFormat(a||""),this.isSeen=c,this.isEditingSuggestion=u,this.disableVoting=d}isCreatedByUser(t){return!(!t||!this.user)&&t.id==this.user.id}static createCopy(t){const e=new r(t.id,t.text,t.user,t.votes,t.dateCreated,t.dateUpdated,t.link,t.isSeen,t.isEditingSuggestion,t.disableVoting);return e.isBeingEdited=t.isBeingEdited,e.isBeingSynced=t.isBeingSynced,e.isSyncingVotes=t.isSyncingVotes,e.productId=t.productId,e.isEditingSuggestion=t.isEditingSuggestion,e.meapVersion=t.meapVersion,e.oldForumId=t.oldForumId,e.disableVoting=t.disableVoting,e}}},156:function(t,e,o){"use strict";o.d(e,"a",(function(){return s}));var n,r=o(137);!function(t){t[t.Private=0]="Private",t[t.Public=1]="Public",t[t.Question=2]="Question"}(n||(n={}));class s extends r.a{constructor(t,e,o,n,r,s,i,a="",c,u,d=!1){super(t,o,n,r,s,i,a),this.isOpen=!1,this.title=e,this.isEditingSuggestion=c,this.posts=u||[],this.disableVoting=d}countNotSeenPosts(){let t=0;for(let e of this.posts)e.isSeen||t++;return t}hasPostsNewerThan(t){if(this.dateCreated>t)return!0;for(let e of this.posts)if(e.dateCreated>t)return!0;return!1}containsUnseen(){if(!this.isSeen)return!0;for(const t of this.posts)if(!t.isSeen)return!0;return!1}containsCommentId(t){if(!t)return!1;if(this.id==t)return!0;for(const e of this.posts)if(e.id==t)return!0;return!1}isCreatedByUser(t){return!(!t||!this.user)&&t.id==this.user.id}containsCommentsByUser(t){if(!t)return!1;if(null!=this.user&&this.user.id==t.id)return!0;for(const e of this.posts)if(e.isCreatedByUser(t))return!0;return!1}static createCopy(t,e=!0){const o=e?t.posts.concat([]):t.posts,n=new s(t.id,t.title,t.text,t.user,t.votes,t.dateCreated,t.dateUpdated,t.link,t.isEditingSuggestion,o,t.disableVoting);return n.isOpen=t.isOpen,n.isBeingSynced=t.isBeingSynced,n.isBeingEdited=t.isBeingEdited,n.productExternalId=t.productExternalId,n.productId=t.productId,n.element=t.element,n.location=t.location,n.isEditingSuggestion=t.isEditingSuggestion,n.meapVersion=t.meapVersion,n.oldForumId=t.oldForumId,n.disableVoting=t.disableVoting,n}}},157:function(t,e,o){"use strict";o.d(e,"a",(function(){return n}));class n{constructor(t,e,o=""){this.id=t,this.name=e,this.avatarUrl=o,this.votes=[],this.spamCommentIds=[]}static createCopy(t,e=!0,o=!0){const r=e?t.votes.concat([]):t.votes,s=o?t.spamCommentIds.concat([]):t.spamCommentIds,i=new n(t.id,t.name,t.avatarUrl);return i.votes=r,i.spamCommentIds=s,i.authorizedProductIds=t.authorizedProductIds,i}}},189:function(t,e,o){"use strict";var n;o.d(e,"a",(function(){return n})),function(t){t[t.MostRecent=0]="MostRecent",t[t.Alphabetical=1]="Alphabetical",t[t.CommentCount=2]="CommentCount"}(n||(n={}))},215:function(t,e,o){"use strict";o.d(e,"a",(function(){return n}));const n=new class{constructor(){this.cacheMap={}}getProductToc(t,e,o,n,r){return o?this.getLivebookToc(t,e):n?this.getLivevideoToc(t,e):r?this.getPbcToc(t,e):Promise.resolve({})}getLivebookToc(t,e){return this.cacheMap[e]?this.cacheMap[e]:this.cacheMap[e]=new Promise((o,n)=>{t.ajax(t.getAbsoluteLivebookAwsUrl(`${e}/tocAndIndex.json`),t=>o(t.toc),t=>{delete this.cacheMap[e],n(t)})})}getLivevideoToc(t,e){return this.cacheMap[e]?this.cacheMap[e]:this.cacheMap[e]=new Promise((o,n)=>{t.ajax(t.getAbsoluteBackendLivevideoUrl("course/getToc"),t=>o(t),t=>{delete this.cacheMap[e],n(t)},{id:e},!0)})}getPbcToc(t,e){return this.cacheMap[e]?this.cacheMap[e]:this.cacheMap[e]=new Promise((o,n)=>{t.ajax(t.getAbsoluteBackendLivevideoUrl("course/getToc"),t=>o(t),t=>{delete this.cacheMap[e],n(t)},{id:e},!0)})}}},392:function(t,e,o){"use strict";o.d(e,"a",(function(){return b}));var n=o(136),r=o(156),s=o(137),i=o(157),a=o(17),c=o(117),u=o(132),d=o(93),l=o(108),m=o(215);const h="General",p="Errata",g="Author Online Forum Legacy Posts",f="Group chat";class b{constructor(t,e){this.groupChatThreadName=f,this.productCommentsMap={},this.sourceApp=t,this.deploymentType=e,this.webUtils=new c.a(a.c.getConfig(t,e)),l.a.setSourceApp(t),l.a.setDeploymentType(e)}notifyAuthor(t,e,o){return new Promise((n,r)=>{this.webUtils.ajax(this.webUtils.getAbsoluteBackendUrl("/api/comment/notifyAuthors"),()=>n(),()=>{alert("Error notifying author about a post. Please try later."),r()},{userId:t&&t.id,commentId:e&&e.id,message:o},!1,!0)})}saveEmailNotificationChoice(t){return new Promise((e,o)=>{this.webUtils.ajax(this.webUtils.getAbsoluteBackendUrl("/api/comment/setRecieveEmailNotifications"),()=>e(),()=>o(),{value:t},!1,!0)})}createDiscussionVisitInfo(t){return new Promise((e,o)=>{this.isSendingDiscussionVisitInfo?setTimeout(()=>{this.sendDiscussionVisitInfo(t,e,o)},500):this.sendDiscussionVisitInfo(t,e,o)})}sendDiscussionVisitInfo(t,e,o){this.isSendingDiscussionVisitInfo=!0,this.webUtils.ajax(this.webUtils.getAbsoluteBackendUrl("/api/discussionVisitInfo/createDiscussionVisitInfo"),()=>{this.isSendingDiscussionVisitInfo=!1,e()},()=>{this.isSendingDiscussionVisitInfo=!1,o()},{bookManningId:t},!1,!0)}getForumVisitInfo(){return new Promise((t,e)=>{this.webUtils.ajax(this.webUtils.getAbsoluteBackendUrl("/api/discussionVisitInfo/getDiscussionVisitInfo"),e=>{for(const o in e)"string"==typeof e[o].lastVisitDate&&(e[o].lastVisitDate=new Date(e[o].lastVisitDate)),e[o].visitedElements||(e[o].visitedElements={}),t(e)},t=>e(t),{},!1,!0)})}getNotifications(){return this.notificationsPromise?this.notificationsPromise:this.notificationsPromise=new Promise((t,e)=>{this.webUtils.ajax(this.webUtils.getAbsoluteBackendUrl("/api/comment/getNotifications"),e=>{this.notificationsPromise=null;const o=this.getThreadsFromComments(e);t(o.map(t=>(t.isOpen=!0,new n.a(t.productTitle,new u.c(t.productExternalId,t.element,t.location,this.extractBaseLink(t.link),t.meapVersion),[t],{},{}))))},t=>{e(t),this.notificationsPromise=null},{},!1,!0)})}markAsSeen(t){return t&&0!=t.length?new Promise((e,o)=>{this.webUtils.ajax(this.webUtils.getAbsoluteBackendUrl("/api/comment/markAsSeen"),()=>e(),t=>o(t),{commentIds:t},!1,!0)}):Promise.resolve()}getFullPathToLocationForum(t,e,o,r,s,i){return new Promise((a,c)=>{this.getProductForum(t).then(c=>{const d={locationForum:null,elementForum:null,productForum:c},m=c.elementForums.find(t=>t.element==e);null!=m?(d.elementForum=m.forum,d.locationForum=new n.a(o,new u.c(t,e,o,r,s),m.forum.threads.filter(t=>t.location==o||i&&t.location==i),c.authorIdMap,c.moderatorIdMap)):(d.elementForum=new n.a(l.a.adjustElementTitle(e),new u.c(t,e,"",r,s),[],c.authorIdMap,c.moderatorIdMap),d.locationForum=new n.a(o,new u.c(t,e,o,r,s),[],c.authorIdMap,c.moderatorIdMap)),a(d)}).catch(t=>c(t))})}getProductForums(t,e,o){const n={},r=this.sourceApp==a.b.livevideo,s=this.sourceApp==a.b.pbc;return r&&(n.onlyLiveVideos=!l.a.shouldShowLivebooks()),s&&(n.onlyLiveProjects=!0,n.courseId=o),n.onlyLiveVideos||n.onlyLiveProjects||null==t||null==e||(n.startDate=d.a.formatDate(t<e?t:e),n.endDate=d.a.formatDate(t>e?t:e)),new Promise((t,e)=>{this.webUtils.ajax(this.webUtils.getAbsoluteBackendUrl("/api/comment/getProductsWithComments"),e=>{if(!e||!e.length)return void t([]);let o=e.map(t=>new u.e(t.productId,t.productExternalId,0,t.productSlug,t.productTitle,t.commentCount,0,d.a.getDateFromString(t.lastCommentDate),[],t.isLiveBook,t.isLiveVideo,t.isLiveProject));n.onlyLiveProjects&&(o=o.filter(t=>t.isLiveProject)),o.sort((t,e)=>t.lastCommentDate>e.lastCommentDate?-1:t.lastCommentDate<e.lastCommentDate?1:0),t(o)},t=>e(t),n,!1,!0)})}search(t,e){return new Promise((o,n)=>{const r={query:t,productExternalId:e&&e.productExternalId};l.a.groupId&&(r.groupId=l.a.groupId),this.webUtils.ajax(this.webUtils.getAbsoluteBackendUrl("/api/comment/search"),t=>{const n=this.getProductForumsFromComments(e&&e.productId,e&&e.productExternalId,e&&e.productMeapVersion,e&&e.productTitle,e&&e.productSlug,t,[],[],[],{},e&&e.isLivebook,e&&e.isLivevideo,e&&e.isLiveProject);o(n.allThreads)},t=>n(t),r,!1,!0)})}refreshProductForum(t){return this.getProductForum(t)}getProductForum(t){return new Promise((e,o)=>{this.getProductComments(t).then(t=>{const o=new u.e(t.productId,t.productExternalId,t.productMeapVersion,t.productSlug,t.productTitle,t.numberOfComments,0,t.lastCommentDate,t.elementForums,t.isLiveBook,t.isLiveVideo,t.isLiveProject);o.authorIdMap=t.authorIdMap,o.moderatorIdMap=t.moderatorIdMap,e(o)}).catch(t=>o(t))})}getProductElementParagraphCommentCountMap(t,e){return new Promise((o,n)=>{this.getRawProductElementComments(t,e).then(t=>{const e={};if(t&&t.comments)for(const o of t.comments)e[o.location]||(e[o.location]=0),e[o.location]++;o(e)}).catch(t=>n(t))})}getRawProductElementComments(t,e){return new Promise((o,n)=>{this.webUtils.ajax(this.webUtils.getAbsoluteBackendUrl("/api/comment/getProductElementComments"),t=>o(t),t=>n(t),{productExternalId:t,element:e},!1,!0)})}getProductComments(t){const e=`${t}-${l.a.groupId||""}`;return this.productCommentsMap[e]?this.productCommentsMap[e]:this.productCommentsMap[e]=new Promise((o,n)=>{this.getRawProductComments(t).then(n=>{n.isLiveProject&&(this.groupChatThreadName=f),this.getProductToc(t,n.isLiveBook,n.isLiveVideo,n.isLiveProject).then(r=>{const s=this.getProductForumsFromComments(n.productId,t,n.productMeapVersion,n.productTitle,n.productSlug,n.comments,n.authorIds,n.moderatorIds,n.onlineIds,this.buildElementFullNameMapFromToc(r),n.isLiveBook,n.isLiveVideo,n.isLiveProject);delete this.productCommentsMap[e],o(s)}).catch(r=>{const s=this.getProductForumsFromComments(n.productId,t,n.productMeapVersion,n.productTitle,n.productSlug,n.comments,n.authorIds,n.moderatorIds,n.onlineIds,{},n.isLiveBook,n.isLiveVideo,n.isLiveProject);delete this.productCommentsMap[e],o(s)})}).catch(t=>{delete this.productCommentsMap[e],n(t)})})}buildElementFullNameMapFromToc(t){const e={};if(!t)return e;try{if(t.chapters||t.frontMatter||t.backMatter){let o=t.chapters;if(!o){o=[];for(const e of t.parts)o.push(...e.chapters)}const n=[...t.frontMatter||[],...o||[],...t.backMatter||[]];for(const t of n)e[t.shortName]=t.title}else if(t&&t.length)for(const o of t)if(o.link&&(e[(o.link||"").replace("search/","")]=o.title),o.children&&o.children.length)for(const t of o.children)t.link&&(e[(t.link||"").replace("search/","")]=t.title)}catch(t){console.log("Error building element full name map")}return e}getRawProductComments(t){const e={productExternalId:t};return l.a.groupId&&(e.groupId=l.a.groupId),new Promise((t,o)=>{this.webUtils.ajax(this.webUtils.getAbsoluteBackendUrl("/api/comment/getProductComments"),e=>t(e),t=>o(t),e,!1,!0)})}getProductToc(t,e,o,n){return m.a.getProductToc(new c.a(a.c.getConfig(this.sourceApp,this.deploymentType)),t,e,o,n)}getThreadsFromComments(t){const e=[];if(!t||!t.length)return e;const o={},n={},i={};t.sort((t,e)=>+t.id-+e.id);for(const a of t)if(!i[a.id])if(i[a.id]=!0,a.parent){const t=new s.a(a.id,a.text,this.getUser(n,a),a.voteScore,d.a.getDateFromString(a.dateCreated),d.a.getDateFromString(a.lastUpdated),a.link||"","isSeen"in a?!!a.isSeen:void 0,void 0,a.disableVoting||!1);t.productId=a.productId,t.oldForumId=a.oldForumId;const e=o[a.parent.id];null!=e&&e instanceof r.a&&e.posts.push(t)}else{const t=new r.a(a.id,a.title,a.text,this.getUser(n,a),a.voteScore,d.a.getDateFromString(a.dateCreated),d.a.getDateFromString(a.lastUpdated),a.link||"",!!a.isEditingSuggestion,[],a.disableVoting||!1);e.push(t),t.productId=a.productId,t.element=a.element,t.location=a.location,t.productExternalId=a.productExternalId,t.oldForumId=a.oldForumId,o[t.id]=t}return e}getProductForumsFromComments(t,e,o,i,a,c,m,b,w,I={},v,C,S){const U={productId:t,productExternalId:e,productMeapVersion:o,productTitle:i,productSlug:a,meapVersion:"",numberOfComments:0,lastCommentDate:null,elementLocationsForums:{},authorIdMap:d.a.getMapFromArray(m),moderatorIdMap:d.a.getMapFromArray(b),allThreads:[],elementForums:[],isLiveBook:v,isLiveVideo:C,isLiveProject:S},P={},k={},L={};U.numberOfComments=c.length,c.sort((t,e)=>+t.id-+e.id);for(const t of c)if(t.parent){const e=new s.a(t.id,t.text,this.getUser(L,t),t.voteScore,d.a.getDateFromString(t.dateCreated),d.a.getDateFromString(t.lastUpdated),t.link||"",!!t.isSeen,!!t.isEditingSuggestion,t.disableVoting||!1);e.meapVersion=t.meapVersion,e.productId=t.productId;const o=P[t.parent.id];null!=o&&o instanceof r.a&&o.posts.push(e)}else{const s=new r.a(t.id,t.title,t.text,this.getUser(L,t),t.voteScore,d.a.getDateFromString(t.dateCreated),d.a.getDateFromString(t.lastUpdated),t.link||"",!!t.isEditingSuggestion,[],t.disableVoting||!1);(!U.lastCommentDate||U.lastCommentDate<s.dateCreated)&&(U.lastCommentDate=s.dateCreated),s.productId=t.productId,s.element=t.element,s.location=t.location,s.meapVersion=t.meapVersion,s.oldForumId=t.oldForumId,P[s.id]=s,U.allThreads.push(s);const i=t.oldForumId?g:t.element||h,a=t.location||"",c=t.oldForumId?"":this.extractBaseLink(t.link||"");U.elementLocationsForums[i]||(U.elementLocationsForums[i]={}),k[i]||(k[i]=new u.a(i,I[i]||i,new n.a(l.a.adjustElementTitle(I[i]||i),new u.c(e,i,"",c,o),[],U.authorIdMap,U.moderatorIdMap),new Date(1970))),s.isEditingSuggestion&&l.a.shouldShowErrata&&(k[p]||(k[p]=new u.a(p,p,new n.a(p,new u.c(e,p,"",c,o),[],U.authorIdMap,U.moderatorIdMap),new Date(1970))),k[p].forum.threads.push(s)),U.elementLocationsForums[i][a]||(U.elementLocationsForums[i][a]=new n.a(a,new u.c(e,i,a,c,o),[],U.authorIdMap,U.moderatorIdMap)),U.elementLocationsForums[i][a].threads.push(s),k[i].forum.threads.push(s)}const M=this.groupChatThreadName||f;S&&l.a.shouldShowGroupChat?k[M]||(k[M]=new u.a(M,M,new n.a(M,new u.c(e,M,"","",""),[],U.authorIdMap,U.moderatorIdMap),new Date(1970))):delete k[M];const x=h;k[x]||(k[x]=new u.a(x,x,new n.a(x,new u.c(e,"","","",""),[],U.authorIdMap,U.moderatorIdMap),new Date(1970))),l.a.shouldShowErrata?k[p]?k[p].keepUniqueThreads():k[p]=new u.a(p,p,new n.a(p,new u.c(e,p,"","",""),[],U.authorIdMap,U.moderatorIdMap),new Date(1970)):delete k[p];for(const t in k){const e=k[t];if(e&&e.forum.threads){let t=e.lastCommentDate;for(const o of e.forum.threads)o.dateCreated>t&&(t=o.dateCreated),null!=o.posts&&1==o.posts.length&&o.posts[0].dateCreated>t&&(t=o.posts[0].dateCreated),o.posts.sort((e,o)=>(e.dateCreated>t&&(t=e.dateCreated),o.dateCreated>t&&(t=o.dateCreated),e.dateCreated>o.dateCreated?1:e.dateCreated<o.dateCreated?-1:0));e.lastCommentDate=t}}return U.elementForums=d.a.getArrayFromMap(k),U}extractBaseLink(t){return(t||"").replace(/\/comment-[0-9]+/i,"")}getUser(t,e){if(!t[e.userId]){const o=e.displayName||`${e.userFirstName} ${e.userLastName}`;t[e.userId]=new i.a(e.userId,o,e.avatarUrl||"")}return t[e.userId]}createThread(t){const e=this.getAdjustedForumLocation(),o={productExternalId:e.productExternalId,element:e.element,location:e.location,link:encodeURI(e.baseLink||""),title:t.title,text:t.text};return o.element!=f||l.a.groupId?(e.meapVersion&&"0"!=e.meapVersion&&(o.meapVersion=e.meapVersion),o.element!=h&&l.a.groupId&&(o.groupId=l.a.groupId),new Promise((t,e)=>{this.webUtils.ajax(this.webUtils.getAbsoluteBackendUrl("/api/comment/create"),o=>{o.success?(null==o.comment&&e("Couldn't create comment"),t({id:o.comment.id,link:o.comment.link})):e(o.reason)},t=>e(t),o,!1,!0)})):(alert("Cannot add thread when not in a group. Try later."),Promise.reject())}createPost(t,e){const o=this.getAdjustedForumLocation(),n={productId:t.productId||"",productExternalId:t.productExternalId||o&&o.productExternalId,element:t.element||o&&o.element,location:t.location||o&&o.location,title:"",text:e.text,link:this.removeCommentIdSegment(t.link)||o&&o.baseLink||"",parent:t.id};if(n.element==f&&!l.a.groupId)return alert("Cannot add post when not in a group. Try later."),Promise.reject();const r=t.meapVersion||o&&o.meapVersion;return r&&"0"!=r&&(n.meapVersion=r),n.element!=h&&l.a.groupId&&(n.groupId=l.a.groupId),new Promise((t,e)=>{this.webUtils.ajax(this.webUtils.getAbsoluteBackendUrl("/api/comment/create"),o=>{o.success?(null==o.comment&&e("Couldn't create comment"),t({id:o.comment.id,link:o.comment.link})):e(o.reason)},t=>e(t),n,!1,!0)})}getAdjustedForumLocation(){const t=l.a.getCurrentLocation();return this.sourceApp!=a.b.pbc||null==t||t.element!=f&&t.element!=h||(t.location=document.location.pathname),t}deletePost(t){return new Promise((e,o)=>{this.webUtils.ajax(this.webUtils.getAbsoluteBackendUrl("/api/comment/delete"),t=>{t&&t.success?e():o("error when deleting post")},t=>o(t),{id:t.id},!1,!0)})}saveEditedPost(t){return new Promise((e,o)=>{this.webUtils.ajax(this.webUtils.getAbsoluteBackendUrl("/api/comment/update"),t=>{t&&t.success?e():o("error when updating post")},t=>o(t),{id:t.id,text:t.text,title:t.title},!1,!0)})}votePost(t,e,o){return new Promise((t,n)=>{this.webUtils.ajax(this.webUtils.getAbsoluteBackendUrl("/api/comment/vote"),e=>t(e),t=>n(t),{id:e.id,vote:o>0?1:-1},!1,!0)})}revokeVote(t,e){return new Promise((t,o)=>{this.webUtils.ajax(this.webUtils.getAbsoluteBackendUrl("/api/comment/revokeVote"),e=>t(e),t=>o(t),{id:e.id},!1,!0)})}toggleEditSuggestion(t,e,o){return new Promise((t,n)=>{this.webUtils.ajax(this.webUtils.getAbsoluteBackendUrl("/api/comment/toggleEditingSuggestion"),e=>t(e&&e.isEditingSuggestion),t=>n(t),{id:e,isEditingSuggestion:o},!1,!0)})}toggleSpam(t,e,o){return new Promise((t,n)=>{this.webUtils.ajax(this.webUtils.getAbsoluteBackendUrl("/api/comment/toggleSpam"),e=>t(e),t=>n(t),{id:e,isSpam:o},!1,!0)})}clearSpamFlags(t){return new Promise((e,o)=>{this.webUtils.ajax(this.webUtils.getAbsoluteBackendUrl("/api/comment/clearSpamFlags"),t=>e(),t=>o(t),{commentId:t},!1,!0)})}getVotes(t){return new Promise((e,o)=>{this.webUtils.ajax(this.webUtils.getAbsoluteBackendUrl("/api/comment/getVotes"),t=>e(t),t=>o(t),{userId:t},!1,!0)})}getUserSpamFlags(t){return new Promise((e,o)=>{this.webUtils.ajax(this.webUtils.getAbsoluteBackendUrl("/api/comment/getUserSpamFlags"),t=>e(t),t=>o(t),{userId:t},!1,!0)})}getUsersCommentInfo(){return new Promise((t,e)=>{this.webUtils.ajax(this.webUtils.getAbsoluteBackendUrl("/api/comment/getUsersCommentInfo"),e=>t(e),t=>e(t),{},!1,!0)})}removeCommentIdSegment(t){if(!t)return t;const e=t.indexOf("/comment-");return-1!=e?t.substr(0,e):t}}},88:function(t,e,o){"use strict";var n,r=function(){return void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n},s=function(){var t={};return function(e){if(void 0===t[e]){var o=document.querySelector(e);if(window.HTMLIFrameElement&&o instanceof window.HTMLIFrameElement)try{o=o.contentDocument.head}catch(t){o=null}t[e]=o}return t[e]}}(),i=[];function a(t){for(var e=-1,o=0;o<i.length;o++)if(i[o].identifier===t){e=o;break}return e}function c(t,e){for(var o={},n=[],r=0;r<t.length;r++){var s=t[r],c=e.base?s[0]+e.base:s[0],u=o[c]||0,d="".concat(c," ").concat(u);o[c]=u+1;var l=a(d),m={css:s[1],media:s[2],sourceMap:s[3]};-1!==l?(i[l].references++,i[l].updater(m)):i.push({identifier:d,updater:f(m,e),references:1}),n.push(d)}return n}function u(t){var e=document.createElement("style"),n=t.attributes||{};if(void 0===n.nonce){var r=o.nc;r&&(n.nonce=r)}if(Object.keys(n).forEach((function(t){e.setAttribute(t,n[t])})),"function"==typeof t.insert)t.insert(e);else{var i=s(t.insert||"head");if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(e)}return e}var d,l=(d=[],function(t,e){return d[t]=e,d.filter(Boolean).join("\n")});function m(t,e,o,n){var r=o?"":n.media?"@media ".concat(n.media," {").concat(n.css,"}"):n.css;if(t.styleSheet)t.styleSheet.cssText=l(e,r);else{var s=document.createTextNode(r),i=t.childNodes;i[e]&&t.removeChild(i[e]),i.length?t.insertBefore(s,i[e]):t.appendChild(s)}}function h(t,e,o){var n=o.css,r=o.media,s=o.sourceMap;if(r?t.setAttribute("media",r):t.removeAttribute("media"),s&&btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}var p=null,g=0;function f(t,e){var o,n,r;if(e.singleton){var s=g++;o=p||(p=u(e)),n=m.bind(null,o,s,!1),r=m.bind(null,o,s,!0)}else o=u(e),n=h.bind(null,o,e),r=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(o)};return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else r()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=r());var o=c(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var n=0;n<o.length;n++){var r=a(o[n]);i[r].references--}for(var s=c(t,e),u=0;u<o.length;u++){var d=a(o[u]);0===i[d].references&&(i[d].updater(),i.splice(d,1))}o=s}}}},89:function(t,e,o){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var o=function(t,e){var o=t[1]||"",n=t[3];if(!n)return o;if(e&&"function"==typeof btoa){var r=(i=n,a=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(c," */")),s=n.sources.map((function(t){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(t," */")}));return[o].concat(s).concat([r]).join("\n")}var i,a,c;return[o].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(o,"}"):o})).join("")},e.i=function(t,o,n){"string"==typeof t&&(t=[[null,t,""]]);var r={};if(n)for(var s=0;s<this.length;s++){var i=this[s][0];null!=i&&(r[i]=!0)}for(var a=0;a<t.length;a++){var c=[].concat(t[a]);n&&r[c[0]]||(o&&(c[2]?c[2]="".concat(o," and ").concat(c[2]):c[2]=o),e.push(c))}},e}}}]);
//# sourceMappingURL=vendors~discussionParagraphNotificationsModule.chunk.js.map?b3cd153764e45e32c6e0