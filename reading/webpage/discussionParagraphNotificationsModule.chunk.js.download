(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{120:function(e,t,r){"use strict";var n=Object.prototype.hasOwnProperty,o="~";function a(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function s(e,t,r,n,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,n||e,a),u=o?o+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function u(e,t){0==--e._eventsCount?e._events=new a:delete e._events[t]}function l(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),(new a).__proto__||(o=!1)),l.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)n.call(e,t)&&r.push(o?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},l.prototype.listeners=function(e){var t=o?o+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var n=0,a=r.length,i=new Array(a);n<a;n++)i[n]=r[n].fn;return i},l.prototype.listenerCount=function(e){var t=o?o+e:e,r=this._events[t];return r?r.fn?1:r.length:0},l.prototype.emit=function(e,t,r,n,a,i){var s=o?o+e:e;if(!this._events[s])return!1;var u,l,c=this._events[s],b=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),b){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,n),!0;case 5:return c.fn.call(c.context,t,r,n,a),!0;case 6:return c.fn.call(c.context,t,r,n,a,i),!0}for(l=1,u=new Array(b-1);l<b;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var h,p=c.length;for(l=0;l<p;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),b){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,r);break;case 4:c[l].fn.call(c[l].context,t,r,n);break;default:if(!u)for(h=1,u=new Array(b-1);h<b;h++)u[h-1]=arguments[h];c[l].fn.apply(c[l].context,u)}}return!0},l.prototype.on=function(e,t,r){return s(this,e,t,r,!1)},l.prototype.once=function(e,t,r){return s(this,e,t,r,!0)},l.prototype.removeListener=function(e,t,r,n){var a=o?o+e:e;if(!this._events[a])return this;if(!t)return u(this,a),this;var i=this._events[a];if(i.fn)i.fn!==t||n&&!i.once||r&&i.context!==r||u(this,a);else{for(var s=0,l=[],c=i.length;s<c;s++)(i[s].fn!==t||n&&!i[s].once||r&&i[s].context!==r)&&l.push(i[s]);l.length?this._events[a]=1===l.length?l[0]:l:u(this,a)}return this},l.prototype.removeAllListeners=function(e){var t;return e?(t=o?o+e:e,this._events[t]&&u(this,t)):(this._events=new a,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=o,l.EventEmitter=l,e.exports=l},164:function(e,t,r){"use strict";var n=r(4),o=r(13),a=r(22),i=(r(190),r(0)),s=r(6),u=r(141),l=r(12);const c=$(document);t.a=new class{constructor(){this.bookmarkedTextLimit=80,this.paragraphBubbleTemplate=' <div class="paragraph-bubble">\n        <div aria-haspopup="true" class="text-margin-icon-bubble bookmark-bubble" title="bookmark"><i class="fa fa-bookmark"></i></div>\n        <div aria-haspopup="true" class="text-margin-icon-bubble forums-bubble" title="open discussion"><i class="fa fa-comments" aria-hidden="true"></i><span class="comment-count-container"></span></div>\n        <div aria-haspopup="true" class="text-margin-icon-bubble paragraph-notification-bubble" title="show text addons"><i class="fa fa-dot-circle" aria-hidden="true"></i></div>\n        <div class="text-margin-icon-bubble editor-bubble"><i class="fa fa-edit fa-2x"></i></div>\n    </div>',n.a.onDescendantEventWithCooldown(c,i.b.isCordova()?"touchstart":"click",".bookmark-bubble",e=>{this.handleBookmarkBubbleClick(e.currentTarget.parentElement)}),n.a.onDescendantEventWithCooldown(c,i.b.isCordova()?"touchstart":"click",".forums-bubble",e=>{this.handleForumBubbleClick(e.currentTarget.parentElement)}),c.on("paragraphButtonsSetForumCount",(e,t,r)=>this.setForumCount(t,r)),c.on("requestSelectForumsBubble",(e,t)=>this.selectForumsBubble(t)),c.on("requestDeselectForumsBubble",(e,t)=>this.deselectForumsBubble(t))}initialize(e,t,r=!1){if(this.clean(),this.book=e,this.bookElement=t,e&&(this.paragraphs=Array.prototype.slice.call(document.querySelectorAll("[refid]")),s.a.isCurrentlyLoggedIn()&&(r||u.a.fetchBookmarks(this.bookElement).then(e=>{this.updateBookmarkData(e.bookElementBookmarks)}),r)))for(const e of this.paragraphs){0==$(e).closest(".introduction-summary").length&&this.createParagraphBubble(e,!0)}}clean(){this.book=null,this.bookElement=null,$(".text-margin-icon-bubble").off().remove(),this.paragraphBubbles=[],this.paragraphs=null}createParagraphBubble(e,t=!1){if(!e||null!=e.paragraphBubble)return;const r=$(t?' <div class="paragraph-bubble">\n        <div class="text-margin-icon-bubble editor-bubble"><i class="fa fa-edit fa-2x"></i></div>\n    </div>':this.paragraphBubbleTemplate).get(0);r.paragraph=e,e.paragraphBubble=r,this.paragraphBubbles.push(r);const n=$(e);if(n.is(".listing-container")){const t=n.find(".listing-environment-container");t.length?t.append(r):e.paragraphBubbleToAppend=r}else n.append(r)}toggleBookmark(e){this.createParagraphBubble(e),this.handleBookmarkBubbleClick(e.paragraphBubble)}handleBookmarkBubbleClick(e){s.a.isCurrentlyLoggedIn()?($(e).addClass("activated"),e.hasAttribute("data-bookmark-active")?e.removeAttribute("data-bookmark-active"):e.setAttribute("data-bookmark-active","true"),this.visuallyMarkBookmark(e),this.syncBookmark(e),$(e.paragraph).toggleClass("has-bookmark",e.hasAttribute("data-bookmark-active"))):l.a.requestLogin("sign in to add a bookmark","bookmark")}visuallyMarkBookmark(e,t){if(!e)return;const r=e.hasAttribute("data-bookmark-active"),n=$(e).find(".bookmark-bubble");n.toggleClass("selected",r),n.attr("title",r?"remove bookmark":"bookmark"),t&&n.attr("data-id",t),$(e.paragraph).toggleClass("has-bookmark",r)}syncBookmark(e){if(!e||!e.paragraph)return;const t=$(e.paragraph);e.hasAttribute("data-bookmark-active")?u.a.addBookmark(this.bookElement,t.attr("refid"),t.attr("data-hash"),this.cutText(t.text()),this.getSection(t)).then(t=>{$(e).find(".bookmark-bubble").attr("data-id",t),c.trigger("bookmarkAdded")}):u.a.removeBookmarkByContentID(this.bookElement,t.attr("refid"))}updateBookmarkData(e){if(!e)return;const t=[];for(const r of e){const e=r.contentHash?document.querySelector(`[data-hash='${r.contentHash}']`):document.getElementById(r.contentID);e&&(this.createParagraphBubble(e),e.paragraphBubble.setAttribute("data-bookmark-active","true"),this.visuallyMarkBookmark(e.paragraphBubble,r.id),t.push(e.paragraphBubble))}$(t).show()}selectForumsBubble(e){if(!e)return;const t=$(e);t.addClass("selected"),t.find(".forums-bubble").addClass("bubble-active"),t.attr("data-forums-active","true"),$(".paragraph-focused").removeClass("paragraph-focused"),$(e.paragraph).addClass("paragraph-focused"),$(e.paragraph).addClass("matching-text-bubble-shown")}deselectForumsBubble(e){if(!e)return;const t=$(e);t.removeClass("selected"),t.find(".forums-bubble").removeClass("bubble-active"),t.find(".comment-count-container").text().trim()||t.removeAttr("data-forums-active"),$(".paragraph-focused").removeClass("paragraph-focused"),$(e.paragraph).removeClass("matching-text-bubble-shown")}setForumCount(e,t){if(!e)return;const r=$(e);r.find(".comment-count-container").text(t||""),t?(r.attr("data-forums-active","true"),r.show()):r.removeAttr("data-forums-active")}handleForumBubbleClick(e){a.a.requestOpenParagraphSideMenu(e)}getSection(e){const t=o.a.figureOutSectionOrSubsectionFromRefId(e.attr("refid"));if(t)return t;const r=this.bookElement.shortName.match(/(part\s+\d)|\w+\s+(\d+)/i);if(r){if(r[1])return r[1];if(r[2])return r[2]}return this.book.shortName}cutText(e){return e.length<this.bookmarkedTextLimit?e:e.substring(0,this.bookmarkedTextLimit)+"..."}}},190:function(e,t,r){var n=r(88),o=r(191);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);var a={insert:"head",singleton:!1};n(o,a);e.exports=o.locals||{}},191:function(e,t,r){(t=r(89)(!1)).push([e.i,"body.book-edit .bookmark-bubble,body.book-edit .forums-bubble{display:none}body.book-edit .editor-bubble{display:block}body:not(.book-edit) .editor-bubble{display:none}body.review-book .forums-bubble,body.review-book .bookmark-bubble{display:none}body.review-book .text-selection-tooltip-container .bookmark-button,body.review-book .text-selection-tooltip-container .highlight-button,body.review-book .text-selection-tooltip-container .forum-button,body.review-book .text-selection-tooltip-container .error-report,body.review-book .text-selection-tooltip-container .link-button{display:none}.paragraph-bubble{position:absolute;top:0.3em;right:1%}.paragraph-bubble i{font:normal normal normal 18px/1 'Font Awesome 5 Pro' !important}@media screen and (min-width: 870px){.paragraph-bubble{display:flex}}.paragraph-bubble[data-bookmark-active] .bookmark-bubble{display:block}.paragraph-bubble[data-forums-active] .forums-bubble{display:block}ul .paragraph-bubble{right:-8.5%}.browsable-container .paragraph-bubble{right:-9%}@media screen and (max-width: 390px){.browsable-container .paragraph-bubble{right:-27px}}.listing-environment-container .paragraph-bubble{right:0}.callout-container .paragraph-bubble{right:-11%}@media screen and (max-width: 390px){.callout-container .paragraph-bubble{right:-33px}}.text-margin-icon-bubble{position:relative;width:1.5rem;height:1.9rem;text-align:center;cursor:pointer;color:#9a9aa2;transition:transform 0.25s ease-out;-webkit-transform-origin:50% 50%;-moz-transform-origin:50% 50%;-o-transform-origin:50% 50%;transform-origin:50% 50%;display:none;margin:1px}.text-margin-icon-bubble:hover i,.text-margin-icon-bubble.bubble-active i{transform:scale(1.1)}.text-margin-icon-bubble .comment-count-container{display:none}\n",""]),e.exports=t},60:function(e,t,r){"use strict";r.r(t),r.d(t,"DiscussionParagraphNotifications",(function(){return u}));var n=r(392),o=r(6),a=r(164),i=r(17),s=r(3);const u=new class{constructor(){this.socialWebProvider=new n.a(i.b.livebook,s.a.getDeploymentType())}initialize(e,t){o.a.isLoggedIn().then(()=>this._initialize(e,t)).catch(()=>this._initialize(e,t))}_initialize(e,t,r){null==e||null==t||t.reviewVersion||this.socialWebProvider.getProductElementParagraphCommentCountMap(e.shortName,null!=t?t.shortName:r).then(r=>{if(null!=e&&null!=t)for(const e in r){if(!e)continue;const t=$(`[data-hash=${e}], [refid='${e}']`);if(t.length>0){const n=t[0];a.a.createParagraphBubble(n),$(document).trigger("paragraphButtonsSetForumCount",[n.paragraphBubble,r[e]])}}})}}},93:function(e,t,r){"use strict";const n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var o;!function(e){e[e.Pending=0]="Pending",e[e.Fulfilled=1]="Fulfilled",e[e.Rejected=2]="Rejected"}(o||(o={}));t.a=new class{daysFromNow(e){const t=new Date,r=Math.abs(t.getTime()-e.getTime());return Math.ceil(r/864e5)}isSubsetOf(e,t){if(!e||!t)return!1;if(0==e.length&&t.length>=0)return!0;let r=0;for(const n of e)t.indexOf(n)>=0&&r++;return r==e.length}isNumber(e){try{return!isNaN(+e)}catch(e){return!1}}arrayIntersection(e,t){const r=[];if(null==e||0==e.length||null==t||0==t.length)return r;for(const n of e)t.indexOf(n)>=0&&r.push(n);return r}arrayDifference(e,t){const r=[];if(null==e||0==e.length)return r;if(null==t||0==t.length)return r.concat(e);for(const n of e)-1==t.indexOf(n)&&r.push(n);return r}createArrayFromItemsUpTo(e){const t=[];for(let r=0;r<e;r++)t.push(r);return t}isEmptyObject(e){if(!e)return!0;for(const t in e)return!1;return!0}stringToSlug(e){if(!e)return e;e=(e=e.replace(/^\s+|\s+$/g,"")).toLowerCase();for(var t="àáãäâèéëêìíïîòóöôùúüûñç·/_,:;",r=0,n=t.length;r<n;r++)e=e.replace(new RegExp(t.charAt(r),"g"),"aaaaaeeeeiiiioooouuuunc------".charAt(r));return e=e.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}getDateFromString(e){if(!e)return new Date;let t=new Date(e);if(t instanceof Date&&isFinite(t.getTime()))return t;const r=e.indexOf("+");if(r>=0)return this.getDateFromString(e.substring(0,r));const n=e.indexOf(" ");return n>=0?this.getDateFromString(e.substring(0,n)):t}formatDate(e){if(!e)return"";let t=""+(e.getMonth()+1),r=""+e.getDate(),n=e.getFullYear();return t.length<2&&(t="0"+t),r.length<2&&(r="0"+r),[n,t,r].join("-")}getWords(e){return(e||"").split(/\s+|,|\.|:|\-/g).filter(e=>!!e)}getMapFromArray(e){const t={};if(!e)return t;for(const r of e)t[r]=!0;return t}combineInNew(e,t){return Object.assign({},e,t)}extend(e,t){return Object.assign(e,t)}trimEnd(e,t=" "){if(!e)return e;let r=e.length-1;for(;r>=0&&e.charAt(r)==t;)r--;return e.substring(0,r+1)}getArrayFromMap(e){const t=[];for(const r in e)t.push(e[r]);return t}getArrayFromMapKeys(e){const t=[];for(const r in e)t.push(r);return t}areDeepEqual(e,t){let r,n=Object.keys(e).sort(),o=Object.keys(t).sort();if(n.length!==o.length)return!1;if(n.join("")!==o.join(""))return!1;for(r=0;r<n.length;++r){if(e[n[r]]instanceof Array){if(!(t[n[r]]instanceof Array))return!1;if(t[n[r]].sort().join("")!==e[n[r]].sort().join(""))return!1}else if(e[n[r]]instanceof Date){if(!(t[n[r]]instanceof Date))return!1;if(""+e[n[r]]!=""+t[n[r]])return!1}else if(e[n[r]]instanceof Function){if(!(t[n[r]]instanceof Function))return!1}else if(e[n[r]]instanceof Object){if(!(t[n[r]]instanceof Object))return!1;if(e[n[r]]===e){if(t[n[r]]!==t)return!1}else if(!1===this.areDeepEqual(e[n[r]],t[n[r]]))return!1}if(e[n[r]]!==t[n[r]])return!1}return!0}shuffleArray(e){let t,r,n=e.length;for(;0!==n;)r=Math.floor(Math.random()*n),t=e[n-=1],e[n]=e[r],e[r]=t;return e}removeItemFromArray(e,t){const r=e.indexOf(t);r>=0&&e.splice(r,1)}insertAtLocation(e,t,r){e.splice(r,0,t)}roundToTwoDecimalPlaces(e){return Math.round(100*e)/100}getDateAsString(e,t=!1){if(!e)return"";const r=e.getMonth(),o=e.getFullYear();return Number.isNaN(r)||Number.isNaN(o)?"":t?`${n[r]} ${e.getDate()}, ${o} at ${this.formatToDoubleDigits(e.getHours())}:${this.formatToDoubleDigits(e.getMinutes())}`:`${n[r]} ${o}`}formatToDoubleDigits(e){return e>=10?e:`0${e}`}monthDiff(e,t){let r;return r=12*(t.getFullYear()-e.getFullYear()),r-=e.getMonth()+1,(r+=t.getMonth())<=0?0:r}getOrdinalExtension(e){return e<0?"":1==e?"st":2==e?"nd":3==e?"rd":e>=4?"th":void 0}formatMoney(e){return(e||0).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,")}numberWithCommas(e){try{return(e||0).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}catch(t){return e}}getUniqueItems(e,t){if(!e||!e.length)return[];try{const r={},n=[];for(let o of e)r[o[t]]||(r[o[t]]=!0,n.push(o));return n}catch(t){return console.log("Error getting unique items"),e}}}}}]);
//# sourceMappingURL=discussionParagraphNotificationsModule.chunk.js.map?ae483dc926b53cec2abb